<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <!-- cungudafa百度收录验证编号 -->
  <!-- <meta name="baidu-site-verification" content="LukfTcyXmC" /> -->
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">flutter | 牵风散步の雲</title>
  
    <link rel="shortcut icon" href="/images/sakura.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/cungudafa/cdn/css/style.css" type="text/css" media="all" id="saukra_css-css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/cungudafa/cdn/css/jquery.fancybox.min.css" media="all">  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/cungudafa/cdn/css/lib.min.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/cungudafa/cdn/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/cungudafa/cdn/css/tags.css" media="all">
  
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/cungudafa/cdn/css/logo.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/cungudafa/cdn/fonts/LOGO/logo.css">
  
  <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>

  <!-- 分析 -->
  <!-- Global site tag (gtag.js) - Google Analytics -->


  <!-- Baidu Analytics -->

  
  <!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
  " type="text/css" media="all"> -->
  <script>
    /*Initial Variables*/
    var mashiro_option = new Object();
    var mashiro_global = new Object();
    mashiro_option.NProgressON = true;
    /* 
    * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
    * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
    */
    mashiro_option.email_domain = "";
    mashiro_option.email_name = "";
    mashiro_option.cookie_version_control = "";
    mashiro_option.qzone_autocomplete = false;
    mashiro_option.site_name = "菠箩箩の小破站";
    mashiro_option.author_name = "小破站";
    mashiro_option.site_url = "https://Kiritoabc.github.io";
    mashiro_option.v_appId = "";//
    mashiro_option.v_appKey = "";//
    mashiro_option.mathjax = "1";
    mashiro_option.copyright_enable = "false" ;
    mashiro_option.copyright_minCharNumber = parseInt("120") ;
    mashiro_option.copyright_description = "本文章著作权归作者所有，任何形式的转载都请注明出处。" ;
    mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
    mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

    // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
    // mashiro_option.float_player_on = true;

    /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
    var bg = "https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover7.jpg,https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover.jpg,https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover2.jpg,https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover3.jpg,https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover4.jpg,https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover5.jpg,https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover6.jpg".split(",");
    var bgindex = Math.floor(Math.random()*bg.length);
    if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
      alert('朋友，IE浏览器未适配哦~');
    }
  </script>
<meta name="generator" content="Hexo 7.0.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="牵风散步の雲" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head> 

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <!-- Dynamic sliders -->
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <!-- Main content -->
  <section id="main-container">
    <!-- Top menu -->
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="https://Kiritoabc.github.io">
          <img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/header.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>莫笑江湖少年梦 谁不少年梦江湖</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="https://gitee.com/kirito2493381254" target="_blank" class="social-github" title="gitee">
                    <img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/social/gitee.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://github.com/Kiritoabc" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://blog.csdn.net/A__pineapple?" target="_blank" class="social-github" title="csdn">
                    <img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/social/csdn.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://space.bilibili.com/160107797" target="_blank" class="social-github" title="bilibili">
                    <img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/social/bilibili.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://music.163.com/#/user/home?id=583001071" target="_blank" class="social-github" title="wangyiyun">
                    <img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/social/wangyiyun.png">
                  </a>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  
  <div id="video-container">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <!-- banner -->
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
        <span class="site-title">
            <span class="logolink logo">
                <a href="/">
                    <ruby>
                    <span class="sakuraso">菠箩箩</span>
                    <span class="no">の</span>
                    <span class="shironeko">小屋</span>
                    <rp></rp>
                    <rt class="logo">菠箩箩の</rt>
                    <rp></rp>
                    </ruby>
                  </a>
            </span>
          </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/analytics/">
                          <i class="fa fa-line-chart" aria-hidden="true"></i>
                          统计
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags">
                          <i class="fa fa-tags" aria-hidden="true"></i>
                          标签
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    友人帐
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      
      <!-- body -->
      <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/cungudafa/cdn/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1"
        class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content">  -->
        <!--套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h1 id="flutter"><a href="#flutter" class="headerlink" title="flutter"></a>flutter</h1><h2 id="网络框架dio-v5-3-3"><a href="#网络框架dio-v5-3-3" class="headerlink" title="网络框架dio v5.3.3"></a>网络框架dio v5.3.3</h2><blockquote>
<p>dio 是一个强大的 HTTP 网络请求库，支持全局配置、Restful API、FormData、拦截器、 请求取消、Cookie 管理、文件上传/下载、超时、自定义适配器、转换器等。</p>
</blockquote>
<span id="more"></span>

<h3 id="入门使用"><a href="#入门使用" class="headerlink" title="入门使用"></a>入门使用</h3><p>添加依赖</p>
<pre class=" language-powershell"><code class="language-powershell">flutter pub add dio
</code></pre>
<p>使用</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:dio/dio.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> dio <span class="token operator">=</span> <span class="token function">Dio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">getHttp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'https://dart.dev'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>GET请求</strong></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:dio/dio.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">final</span> dio <span class="token operator">=</span> <span class="token function">Dio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
  Response response<span class="token punctuation">;</span>
  response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/test?id=12&amp;name=dio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// The below request is the same as above.</span>
  response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
    <span class="token string">'/test'</span><span class="token punctuation">,</span>
    queryParameters<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'dio'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><strong>POST请求</strong></p>
<pre class=" language-dart"><code class="language-dart">response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'dio'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>发起多个并发的请求</strong></p>
<pre class=" language-dart"><code class="language-dart">response <span class="token operator">=</span> <span class="token keyword">await</span> Future<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">[</span>dio<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/info'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/token'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>下载文件</strong></p>
<pre class=" language-dart"><code class="language-dart">response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span>
  <span class="token string">'https://www.google.com/'</span><span class="token punctuation">,</span>
  <span class="token string">'${(await getTemporaryDirectory()).path}google.html'</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>以流的方式接收响应数据：</strong></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">final</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
  url<span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token function">Options</span><span class="token punctuation">(</span>responseType<span class="token punctuation">:</span> ResponseType<span class="token punctuation">.</span>stream<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 设置接收类型为 `stream`</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 响应流</span>
</code></pre>
<p><strong>以二进制数组的方式接收响应数据：</strong></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">final</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
  url<span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token function">Options</span><span class="token punctuation">(</span>responseType<span class="token punctuation">:</span> ResponseType<span class="token punctuation">.</span>bytes<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 设置接收类型为 `bytes`</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 类型: List&lt;int></span>
</code></pre>
<p><strong>发送 <code>FormData</code>:</strong></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">final</span> formData <span class="token operator">=</span> FormData<span class="token punctuation">.</span><span class="token function">fromMap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'dio'</span><span class="token punctuation">,</span>
  <span class="token string">'date'</span><span class="token punctuation">:</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toIso8601String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/info'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>通过 <code>FormData</code> 上传多个文件:</strong></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">final</span> formData <span class="token operator">=</span> FormData<span class="token punctuation">.</span><span class="token function">fromMap</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'dio'</span><span class="token punctuation">,</span>
  <span class="token string">'date'</span><span class="token punctuation">:</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toIso8601String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token keyword">await</span> MultipartFile<span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span><span class="token string">'./text.txt'</span><span class="token punctuation">,</span> filename<span class="token punctuation">:</span> <span class="token string">'upload.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token string">'files'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">await</span> MultipartFile<span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span><span class="token string">'./text1.txt'</span><span class="token punctuation">,</span> filename<span class="token punctuation">:</span> <span class="token string">'text1.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">await</span> MultipartFile<span class="token punctuation">.</span><span class="token function">fromFile</span><span class="token punctuation">(</span><span class="token string">'./text2.txt'</span><span class="token punctuation">,</span> filename<span class="token punctuation">:</span> <span class="token string">'text2.txt'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/info'</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> formData<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>监听发送（上传）数据进度:</strong></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
  <span class="token string">'https://www.dtworkroom.com/doris/1/2.0.0/test'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'aa'</span><span class="token punctuation">:</span> <span class="token string">'bb'</span> <span class="token operator">*</span> <span class="token number">22</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  onSendProgress<span class="token punctuation">:</span> <span class="token punctuation">(</span>int sent<span class="token punctuation">,</span> int total<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'$sent $total'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><strong>以流的形式提交二进制数据：</strong></p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// Binary data</span>
<span class="token keyword">final</span> postData <span class="token operator">=</span> <span class="token operator">&lt;</span>int<span class="token operator">></span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
  url<span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> Stream<span class="token punctuation">.</span><span class="token function">fromIterable</span><span class="token punctuation">(</span>postData<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>e<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 构建 Stream&lt;List&lt;int>></span>
  options<span class="token punctuation">:</span> <span class="token function">Options</span><span class="token punctuation">(</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      Headers<span class="token punctuation">.</span>contentLengthHeader<span class="token punctuation">:</span> postData<span class="token punctuation">.</span>length<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 设置 content-length.</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="Dio-APIs"><a href="#Dio-APIs" class="headerlink" title="Dio APIs"></a>Dio APIs</h3><h4 id="创建一个Dio实例并配置它"><a href="#创建一个Dio实例并配置它" class="headerlink" title="创建一个Dio实例并配置它"></a>创建一个Dio实例并配置它</h4><blockquote>
<p>建议在项目中使用Dio单例，这样便可对同一个dio实例发起的所有请求进行一些统一的配置， 比如设置公共header、请求基地址、超时时间等。 这里有一个在<a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example_flutter_app">Flutter工程中使用Dio单例</a> （定义为top level变量）的示例供开发者参考。</p>
</blockquote>
<p>你可以使用默认配置或传递一个可选 <code>BaseOptions</code>参数来创建一个Dio实例 :</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">final</span> dio <span class="token operator">=</span> <span class="token function">Dio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// With default `Options`.</span>

<span class="token keyword">void</span> <span class="token function">configureDio</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// Update default configs.</span>
  dio<span class="token punctuation">.</span>options<span class="token punctuation">.</span>baseUrl <span class="token operator">=</span> <span class="token string">'https://api.pub.dev'</span><span class="token punctuation">;</span>
  dio<span class="token punctuation">.</span>options<span class="token punctuation">.</span>connectTimeout <span class="token operator">=</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  dio<span class="token punctuation">.</span>options<span class="token punctuation">.</span>receiveTimeout <span class="token operator">=</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment" spellcheck="true">// Or create `Dio` with a `BaseOptions` instance.</span>
  <span class="token keyword">final</span> options <span class="token operator">=</span> <span class="token function">BaseOptions</span><span class="token punctuation">(</span>
    baseUrl<span class="token punctuation">:</span> <span class="token string">'https://api.pub.dev'</span><span class="token punctuation">,</span>
    connectTimeout<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    receiveTimeout<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">final</span> anotherDio <span class="token operator">=</span> <span class="token function">Dio</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Dio 的核心 API 是：</p>
<pre class=" language-dart"><code class="language-dart">Future<span class="token operator">&lt;</span>Response<span class="token operator">&lt;</span>T<span class="token operator">>></span> request<span class="token operator">&lt;</span>T<span class="token operator">></span><span class="token punctuation">(</span>
  String path<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  Object<span class="token operator">?</span> data<span class="token punctuation">,</span>
  Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">></span><span class="token operator">?</span> queryParameters<span class="token punctuation">,</span>
  CancelToken<span class="token operator">?</span> cancelToken<span class="token punctuation">,</span>
  Options<span class="token operator">?</span> options<span class="token punctuation">,</span>
  ProgressCallback<span class="token operator">?</span> onSendProgress<span class="token punctuation">,</span>
  ProgressCallback<span class="token operator">?</span> onReceiveProgress<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>
  <span class="token string">'/test'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'dio'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token function">Options</span><span class="token punctuation">(</span>method<span class="token punctuation">:</span> <span class="token string">'GET'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="请求配置"><a href="#请求配置" class="headerlink" title="请求配置"></a>请求配置</h4><p><code>BaseOptions</code> 描述的是 Dio 实例发起网络请求的的公共配置， 而 <code>Options</code> 描述了每一个Http请求的配置信息，每一次请求都可以单独配置， 单次请求的 <code>Options</code> 中的配置信息可以覆盖 <code>BaseOptions</code> 中的配置。 下面是 <code>Options</code> 的配置项：</p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">/// 请求方式。</span>
String method<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 请求基本地址，可以包含路径例如 https://dart.dev/api/。</span>
String<span class="token operator">?</span> baseUrl<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// HTTP 请求头。</span>
Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">></span><span class="token operator">?</span> headers<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 连接服务器超时时间.</span>
Duration<span class="token operator">?</span> connectTimeout<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 两次数据流数据接收的最长间隔时间，注意不是请求的最长接收时间。</span>
Duration<span class="token operator">?</span> receiveTimeout<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 请求内容体，可以是任意类型。</span>
<span class="token keyword">dynamic</span> data<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 请求路径，如果以 http(s)开始, 则 [baseURL] 会被忽略，</span>
<span class="token comment" spellcheck="true">/// 否则将会和 [baseUrl] 拼接出完整的地址。</span>
String path <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 请求的 Content-Type。</span>
<span class="token comment" spellcheck="true">///</span>
<span class="token comment" spellcheck="true">/// 默认值会由 [ImplyContentTypeInterceptor] 根据请求载荷类型进行推导。</span>
<span class="token comment" spellcheck="true">/// 可以调用 [Interceptors.removeImplyContentTypeInterceptor] 进行移除。</span>
<span class="token comment" spellcheck="true">///</span>
<span class="token comment" spellcheck="true">/// 如果你想以 `application/x-www-form-urlencoded` 格式编码请求数据,</span>
<span class="token comment" spellcheck="true">/// 可以设置此选项为 `Headers.formUrlEncodedContentType`,</span>
<span class="token comment" spellcheck="true">/// [Dio] 会自动编码请求体。</span>
String<span class="token operator">?</span> contentType<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 期望以哪种格式（方式）接受响应数据，包括 `json`、`stream` 和 `plain`。</span>
<span class="token comment" spellcheck="true">///</span>
<span class="token comment" spellcheck="true">/// 默认值是 `json`, 当响应头中 content-type 为 `application/json` 时，</span>
<span class="token comment" spellcheck="true">/// dio 会自动将响应内容转化为 json 对象。</span>
<span class="token comment" spellcheck="true">/// 如果想以二进制方式接受响应数据，如下载一个二进制文件，那么可以使用 `stream`。</span>
<span class="token comment" spellcheck="true">///</span>
<span class="token comment" spellcheck="true">/// 如果想以文本（字符串）格式接收响应数据，请使用 `plain`。</span>
ResponseType<span class="token operator">?</span> responseType<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// `validateStatus` 决定 HTTP 响应状态码是否被视为请求成功，</span>
<span class="token comment" spellcheck="true">/// 返回 `true` 请求结果就会按成功处理，否则会按失败处理.</span>
ValidateStatus<span class="token operator">?</span> validateStatus<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 用户自定义字段，可以在 [Interceptor]、[Transformer] 和 [Response] 中依次传递。</span>
Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">></span><span class="token operator">?</span> extra<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 请求地址的参数。</span>
Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span> <span class="token comment" spellcheck="true">/*String|Iterable&lt;String>*/</span> <span class="token operator">></span><span class="token operator">?</span> queryParameters<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 请求数据中数组的编码的方式，默认值为 `multiCompatible`。</span>
ListFormat<span class="token operator">?</span> listFormat<span class="token punctuation">;</span>
</code></pre>
<h4 id="响应数据"><a href="#响应数据" class="headerlink" title="响应数据"></a>响应数据</h4><p>当请求成功时会返回一个Response对象，它包含如下字段：</p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">/// 响应数据。可能已经被转换了类型, 详情请参考 [ResponseType]。</span>
T<span class="token operator">?</span> data<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 响应对应的请求配置。</span>
RequestOptions requestOptions<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 响应的 HTTP 状态码。</span>
int<span class="token operator">?</span> statusCode<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 响应对应状态码的详情信息。</span>
String<span class="token operator">?</span> statusMessage<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 响应是否被重定向</span>
bool isRedirect<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 请求连接经过的重定向列表。如果请求未经过重定向，则列表为空。</span>
List<span class="token operator">&lt;</span>RedirectRecord<span class="token operator">></span> redirects<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 在 [RequestOptions] 中构造的自定义字段。</span>
Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> <span class="token keyword">dynamic</span><span class="token operator">></span> extra<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 响应对应的头数据。</span>
Headers headers<span class="token punctuation">;</span>
</code></pre>
<p>请求成功后，你可以访问到下列字段：</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'https://pub.dev'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>requestOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>注意，<code>Response.extra</code> 与 <code>RequestOptions.extra</code> 是不同的实例，互相之间无关。</p>
<h4 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h4><p>每个 Dio 实例都可以添加任意多个拦截器，他们会组成一个队列，拦截器队列的执行顺序是先进先出。 通过使用拦截器，你可以在请求之前、响应之后和发生异常时（未被 <code>then</code> 或 <code>catchError</code> 处理） 做一些统一的预处理操作。</p>
<pre class=" language-dart"><code class="language-dart">dio<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
  <span class="token function">InterceptorsWrapper</span><span class="token punctuation">(</span>
    onRequest<span class="token punctuation">:</span> <span class="token punctuation">(</span>RequestOptions options<span class="token punctuation">,</span> RequestInterceptorHandler handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// 如果你想完成请求并返回一些自定义数据，你可以使用 `handler.resolve(response)`。</span>
      <span class="token comment" spellcheck="true">// 如果你想终止请求并触发一个错误，你可以使用 `handler.reject(error)`。</span>
      <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    onResponse<span class="token punctuation">:</span> <span class="token punctuation">(</span>Response response<span class="token punctuation">,</span> ResponseInterceptorHandler handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// 如果你想终止请求并触发一个错误，你可以使用 `handler.reject(error)`。</span>
      <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    onError<span class="token punctuation">:</span> <span class="token punctuation">(</span>DioException e<span class="token punctuation">,</span> ErrorInterceptorHandler handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment" spellcheck="true">// 如果你想完成请求并返回一些自定义数据，你可以使用 `handler.resolve(response)`。</span>
      <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>一个简单的自定义拦截器示例:</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:dio/dio.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">CustomInterceptors</span> <span class="token keyword">extends</span> <span class="token class-name">Interceptor</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">onRequest</span><span class="token punctuation">(</span>RequestOptions options<span class="token punctuation">,</span> RequestInterceptorHandler handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'REQUEST[${options.method}] => PATH: ${options.path}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onRequest</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">onResponse</span><span class="token punctuation">(</span>Response response<span class="token punctuation">,</span> ResponseInterceptorHandler handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'RESPONSE[${response.statusCode}] => PATH: ${response.requestOptions.path}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onResponse</span><span class="token punctuation">(</span>response<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Future <span class="token function">onError</span><span class="token punctuation">(</span>DioException err<span class="token punctuation">,</span> ErrorInterceptorHandler handler<span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'ERROR[${err.response?.statusCode}] => PATH: ${err.requestOptions.path}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="完成和终止请求-响应"><a href="#完成和终止请求-响应" class="headerlink" title="完成和终止请求/响应"></a>完成和终止请求/响应</h4><p>在所有拦截器中，你都可以改变请求执行流， 如果你想完成请求/响应并返回自定义数据，你可以 resolve 一个 <code>Response</code> 对象 或返回 <code>handler.resolve(data)</code> 的结果。 如果你想终止（触发一个错误，上层 <code>catchError</code> 会被调用）一个请求/响应， 那么可以 reject 一个<code>DioException</code> 对象或返回 <code>handler.reject(errMsg)</code> 的结果。</p>
<pre class=" language-dart"><code class="language-dart">dio<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
  <span class="token function">InterceptorsWrapper</span><span class="token punctuation">(</span>
    onRequest<span class="token punctuation">:</span> <span class="token punctuation">(</span>options<span class="token punctuation">,</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> handler<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>
        <span class="token function">Response</span><span class="token punctuation">(</span>requestOptions<span class="token punctuation">:</span> options<span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token string">'fake data'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 'fake data'</span>
</code></pre>
<p>如果同时发起多个网络请求，则它们是可以同时进入<code>Interceptor</code> 的（并行的）， 而 <code>QueuedInterceptor</code> 提供了一种串行机制： 它可以保证请求进入拦截器时是串行的（前面的执行完后后面的才会进入拦截器）。</p>
<p>假设这么一个场景：出于安全原因，我们需要给所有的请求头中添加一个 <code>csrfToken</code>， 如果 <code>csrfToken</code> 不存在，我们先去请求 <code>csrfToken</code>，获取到 <code>csrfToken</code> 后再重试。 假设刚开始的时候 <code>csrfToken</code> 为 null，如果允许请求并发，则这些并发请求并行进入拦截器时 <code>csrfToken</code> 都为 null，所以它们都需要去请求 <code>csrfToken</code>，这会导致 <code>csrfToken</code> 被请求多次。 为了避免不必要的重复请求，可以使用 <code>QueuedInterceptor</code>， 这样只需要第一个请求处理一次即可。</p>
<p>完整的示例代码请点击 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/queued_interceptor_crsftoken.dart">这里</a>.</p>
<h4 id="日志拦截器"><a href="#日志拦截器" class="headerlink" title="日志拦截器"></a>日志拦截器</h4><p>我们可以添加 <code>LogInterceptor</code> 拦截器来自动打印请求和响应等日志：</p>
<p><strong>注意：</strong> <code>LogInterceptor</code> 应该保持最后一个被添加到拦截器中， 否则在它之后进行处理的拦截器修改的内容将无法体现。</p>
<h4 id="Dart"><a href="#Dart" class="headerlink" title="Dart"></a>Dart</h4><pre class=" language-dart"><code class="language-dart">dio<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">LogInterceptor</span><span class="token punctuation">(</span>responseBody<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 不输出响应内容体</span>
</code></pre>
<p><strong>注意：</strong> 默认的 <code>logPrint</code> 只会在 DEBUG 模式（启用了断言） 的情况下输出日志。</p>
<p>你也可以使用 <code>dart:developer</code> 中的 <code>log</code> 来输出日志（在 Flutter 中也可以使用）。</p>
<h4 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h4><p>在 Flutter 中你应该使用 <code>debugPrint</code> 来打印日志。</p>
<p>这样也会让调试日志能够通过 <code>flutter logs</code> 获取到。</p>
<p><strong>注意：</strong> <code>debugPrint</code> 的意义 <strong>不是只在 DEBUG 模式下打印</strong>， 而是对输出内容进行节流，从而保证输出完整。 请不要在生产模式使用，除非你有意输出相关日志。</p>
<pre class=" language-dart"><code class="language-dart">dio<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
  <span class="token function">LogInterceptor</span><span class="token punctuation">(</span>
    logPrint<span class="token punctuation">:</span> <span class="token punctuation">(</span>o<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">debugPrint</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h4><p>开发者可以通过继承 <code>Interceptor/QueuedInterceptor</code> 类来实现自定义拦截器。 这是一个简单的 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/custom_cache_interceptor.dart">缓存拦截器</a>。</p>
<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><p>当请求过程中发生错误时, Dio 会将 <code>Error/Exception</code> 包装成一个 <code>DioException</code>:</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 404</span>
  <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'https://api.pub.dev/not-exist'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> on DioException <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// The request was made and the server responded with a status code</span>
  <span class="token comment" spellcheck="true">// that falls out of the range of 2xx and is also not 304.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>response <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>response<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>response<span class="token punctuation">.</span>requestOptions<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Something happened in setting up or sending the request that triggered an Error</span>
    <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>requestOptions<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>message<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h4 id="DioException"><a href="#DioException" class="headerlink" title="DioException"></a>DioException</h4><pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">/// 错误的请求对应的配置。</span>
RequestOptions requestOptions<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 错误的请求对应的响应内容。如果请求未完成，响应内容可能为空。</span>
Response<span class="token operator">?</span> response<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 错误的类型。</span>
DioExceptionType type<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 实际错误的内容。</span>
Object<span class="token operator">?</span> error<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 实际错误的堆栈。</span>
StackTrace<span class="token operator">?</span> stackTrace<span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">/// 错误信息。</span>
String<span class="token operator">?</span> message<span class="token punctuation">;</span>
</code></pre>
<h4 id="使用-application-x-www-form-urlencoded-编码"><a href="#使用-application-x-www-form-urlencoded-编码" class="headerlink" title="使用 application/x-www-form-urlencoded 编码"></a>使用 application/x-www-form-urlencoded 编码</h4><p>默认情况下, Dio 会将请求数据（除了 <code>String</code> 类型）序列化为 JSON。 如果想要以 <code>application/x-www-form-urlencoded</code> 格式编码, 你可以设置 <code>contentType</code> :</p>
<pre class=" language-dart"><code class="language-dart"><span class="token comment" spellcheck="true">// Instance level</span>
dio<span class="token punctuation">.</span>options<span class="token punctuation">.</span>contentType <span class="token operator">=</span> Headers<span class="token punctuation">.</span>formUrlEncodedContentType<span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// or only works once</span>
dio<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>
  <span class="token string">'/info'</span><span class="token punctuation">,</span>
  data<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">'id'</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  options<span class="token punctuation">:</span> <span class="token function">Options</span><span class="token punctuation">(</span>contentType<span class="token punctuation">:</span> Headers<span class="token punctuation">.</span>formUrlEncodedContentType<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h4 id="发送-FormData"><a href="#发送-FormData" class="headerlink" title="发送 FormData"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#%E5%8F%91%E9%80%81-formdata">发送 FormData</a></h4><p>Dio 支持发送 <code>FormData</code>, 请求数据将会以 <code>multipart/form-data</code> 方式编码, <code>FormData</code> 中可以包含一个或多个文件。</p>
<pre><code>final formData = FormData.fromMap({
  'name': 'dio',
  'date': DateTime.now().toIso8601String(),
  'file': await MultipartFile.fromFile('./text.txt',filename: 'upload.txt')
});
final response = await dio.post('/info', data: formData);
</code></pre>
<blockquote>
<p>通常情况下只有 POST 方法支持发送 FormData。</p>
</blockquote>
<p>这里有一个完整的 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/formdata.dart">示例</a>。</p>
<h4 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">多文件上传</a></h4><p>多文件上传时，通过给 key 加中括号 <code>[]</code> 方式作为文件数组的标记，大多数后台也会通过 <code>key[]</code> 来读取多个文件。 然而 RFC 标准中并没有规定多文件上传必须要使用 <code>[]</code>，关键在于后台与客户端之间保持一致。</p>
<pre><code>final formData = FormData.fromMap({
  'files': [
    MultipartFile.fromFileSync('path/to/upload1.txt', filename: 'upload1.txt'),
    MultipartFile.fromFileSync('path/to/upload2.txt', filename: 'upload2.txt'),
  ],
});
</code></pre>
<p>最终编码时会 key 会为 <code>files[]</code>， **如果不想添加 []**，可以通过 <code>Formdata</code> 的 <code>files</code> 来构建：</p>
<pre><code>final formData = FormData();
formData.files.addAll([
  MapEntry(
   'files',
    MultipartFile.fromFileSync('./example/upload.txt',filename: 'upload.txt'),
  ),
  MapEntry(
    'files',
    MultipartFile.fromFileSync('./example/upload.txt',filename: 'upload.txt'),
  ),
]);
</code></pre>
<h4 id="复用-FormData-和-MultipartFile"><a href="#复用-FormData-和-MultipartFile" class="headerlink" title="复用 FormData 和 MultipartFile"></a>复用 <code>FormData</code> 和 <code>MultipartFile</code></h4><p>如果你在重复调用的请求中使用 <code>FormData</code> 或者 <code>MultipartFile</code>，确保你每次使用的都是新实例。 常见的错误做法是将 <code>FormData</code> 赋值给一个共享变量，在每次请求中都使用这个变量。 这样的操作会加大 <strong>无法序列化</strong> 的错误出现的可能性。 你可以像以下的代码一样编写你的请求以避免出现这样的错误：</p>
<pre><code>Future&lt;void&gt; _repeatedlyRequest() async {
  Future&lt;FormData&gt; createFormData() async {
    return FormData.fromMap({
      'name': 'dio',
      'date': DateTime.now().toIso8601String(),
      'file': await MultipartFile.fromFile('./text.txt',filename: 'upload.txt'),
    });
  }
  
  await dio.post('some-url', data: await createFormData());
}
</code></pre>
<h4 id="转换器"><a href="#转换器" class="headerlink" title="转换器"></a>转换器</h4><p>转换器 <code>Transformer</code> 用于对请求数据和响应数据进行编解码处理。 Dio 实现了一个默认转换器 <code>DefaultTransformer</code>。 如果你想对请求和响应数据进行自定义编解码处理，可以提供自定义转换器并通过 <code>dio.transformer</code> 设置。</p>
<blockquote>
<p><code>Transformer.transformRequest</code> 只在 <code>PUT</code>/<code>POST</code>/<code>PATCH</code> 方法中生效， 只有这些方法可以使用请求内容体 (request body)。 但是 <code>Transformer.transformResponse</code> 可以用于所有请求方法的返回数据。</p>
</blockquote>
<h4 id="在-Flutter-中进行设置"><a href="#在-Flutter-中进行设置" class="headerlink" title="在 Flutter 中进行设置"></a>在 Flutter 中进行设置</h4><p>如果你在开发 Flutter 应用，强烈建议通过 <code>compute</code> 在单独的 isolate 中进行 JSON 解码， 从而避免在解析复杂 JSON 时导致的 UI 卡顿。</p>
<pre><code>/// 
Map&lt;String, dynamic&gt; _parseAndDecode(String response) {
  return jsonDecode(response) as Map&lt;String, dynamic&gt;;
}

Future&lt;Map&lt;String, dynamic&gt;&gt; parseJson(String text) {
  return compute(_parseAndDecode, text);
}

void main() {
  // 自定义 `jsonDecodeCallback`
  dio.transformer = DefaultTransformer()..jsonDecodeCallback = parseJson;
  runApp(MyApp());
}
</code></pre>
<h4 id="其它示例"><a href="#其它示例" class="headerlink" title="其它示例"></a>其它示例</h4><p>这里有一个 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/transformer.dart">自定义 Transformer 的示例</a>。</p>
<h4 id="HttpClientAdapter"><a href="#HttpClientAdapter" class="headerlink" title="HttpClientAdapter"></a>HttpClientAdapter</h4><p><code>HttpClientAdapter</code> 是 <code>Dio</code> 和 <code>HttpClient</code> 之间的桥梁。</p>
<p><code>Dio</code> 实现了一套标准且强大的 API，而 <code>HttpClient</code> 则是真正发起 HTTP 请求的对象。</p>
<p>我们通过 <code>HttpClientAdapter</code> 将 <code>Dio</code> 和 <code>HttpClient</code> 解耦， 这样一来便可以自由定制 HTTP 请求的底层实现。 Dio 使用 <code>IOHttpClientAdapter</code> 作为原生平台默认的桥梁， <code>BrowserClientAdapter</code> 作为 Web 平台的桥梁。 你可以通过 <code>HttpClientAdapter()</code> 来根据平台创建它们。</p>
<pre><code>dio.httpClientAdapter = HttpClientAdapter();
</code></pre>
<p>如果你需要单独使用对应平台的适配器：</p>
<ul>
<li><p>对于 Web 平台</p>
<pre><code>import 'package:dio/browser.dart';
// ...
dio.httpClientAdapter = BrowserClientAdapter();
</code></pre>
</li>
<li><p>对于原生平台：</p>
<pre><code>import 'package:dio/io.dart';
// ...
dio.httpClientAdapter = IOClientAdapter();
</code></pre>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/adapter.dart">示例</a> 中包含了一个简单的自定义桥接。</p>
<h4 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86">设置代理</a></h4><p><code>IOHttpClientAdapter</code> 提供了一个 <code>createHttpClient</code> 回调来设置底层 <code>HttpClient</code> 的代理：</p>
<pre><code>import 'package:dio/io.dart';

void initAdapter() {
  dio.httpClientAdapter = IOHttpClientAdapter(
    createHttpClient: () {
      final client = HttpClient();
      client.findProxy = (uri) {
        // 将请求代理至 localhost:8888。
        // 请注意，代理会在你正在运行应用的设备上生效，而不是在宿主平台生效。
        return 'PROXY localhost:8888';
      };
      return client;
    },
  );
}
</code></pre>
<p>完整的示例请查看 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/proxy.dart">这里</a>。</p>
<p>Web 平台不支持设置代理。</p>
<h4 id="HTTPS-证书校验"><a href="#HTTPS-证书校验" class="headerlink" title="HTTPS 证书校验"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#https-%E8%AF%81%E4%B9%A6%E6%A0%A1%E9%AA%8C">HTTPS 证书校验</a></h4><p>HTTPS 证书验证（或公钥固定）是指确保端侧与服务器的 TLS 连接的证书是期望的证书，从而减少中间人攻击的机会。 <a target="_blank" rel="noopener" href="https://owasp.org/www-community/controls/Certificate_and_Public_Key_Pinning">OWASP</a> 中解释了该理论。</p>
<p><strong>服务器响应证书</strong></p>
<p>与其他方法不同，此方法使用服务器本身的证书。</p>
<pre><code>void initAdapter() {
  const String fingerprint = 'ee5ce1dfa7a53657c545c62b65802e4272878dabd65c0aadcf85783ebb0b4d5c';
  dio.httpClientAdapter = IOHttpClientAdapter(
    createHttpClient: () {
      // Don't trust any certificate just because their root cert is trusted.
      final HttpClient client = HttpClient(context: SecurityContext(withTrustedRoots: false));
      // You can test the intermediate / root cert here. We just ignore it.
      client.badCertificateCallback = (cert, host, port) =&gt; true;
      return client;
    },
    validateCertificate: (cert, host, port) {
      // Check that the cert fingerprint matches the one we expect.
      // We definitely require _some_ certificate.
      if (cert == null) {
        return false;
      }
      // Validate it any way you want. Here we only check that
      // the fingerprint matches the OpenSSL SHA256.
      return fingerprint == sha256.convert(cert.der).toString();
    },
  );
}
</code></pre>
<p>你可以使用 OpenSSL 读取密钥的 SHA-256：</p>
<pre><code>openssl s_client -servername pinning-test.badssl.com -connect pinning-test.badssl.com:443 &lt; /dev/null 2&gt;/dev/null \
  | openssl x509 -noout -fingerprint -sha256

#### SHA256 Fingerprint=EE:5C:E1:DF:A7:A5:36:57:C5:45:C6:2B:65:80:2E:42:72:87:8D:AB:D6:5C:0A:AD:CF:85:78:3E:BB:0B:4D:5C
# (remove the formatting, keep only lower case hex characters to match the `sha256` above)
</code></pre>
<p><strong>证书颁发机构验证</strong></p>
<p>当您的服务器具有自签名证书时，可以用下面的方法，但它们不适用于 AWS 或 Let’s Encrypt 等第三方颁发的证书。</p>
<p>有两种方法可以校验证书，假设我们的后台服务使用的是自签名证书，证书格式是 PEM 格式，我们将证书的内容保存在本地字符串中， 那么我们的校验逻辑如下：</p>
<pre><code>void initAdapter() {
  String PEM = 'XXXXX'; // root certificate content
  dio.httpClientAdapter = IOHttpClientAdapter(
    createHttpClient: () {
      final client = HttpClient();
      client.badCertificateCallback = (X509Certificate cert, String host, int port) {
        return cert.pem == PEM; // Verify the certificate.
      };
      return client;
    },
  );
}
</code></pre>
<p>对于自签名的证书，我们也可以将其添加到本地证书信任链中， 这样证书验证时就会自动通过，而不会再走到 <code>badCertificateCallback</code> 回调中：</p>
<pre><code>void initAdapter() {
  String PEM = 'XXXXX'; // root certificate content
  dio.httpClientAdapter = IOHttpClientAdapter(
    onHttpClientCreate: (_) {
      final SecurityContext sc = SecurityContext();
      sc.setTrustedCertificates(File(pathToTheCertificate));
      final HttpClient client = HttpClient(context: sc);
      return client;
    },
  );
}
</code></pre>
<p>注意，通过 <code>setTrustedCertificates()</code> 设置的证书格式必须为 PEM 或 PKCS12， 如果证书格式为 PKCS12，则需将证书密码传入， 这样则会在代码中暴露证书密码，所以客户端证书校验不建议使用 PKCS12 格式的证书。</p>
<h4 id="HTTP-2-支持"><a href="#HTTP-2-支持" class="headerlink" title="HTTP/2 支持"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#http2-%E6%94%AF%E6%8C%81">HTTP/2 支持</a></h4><p><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/plugins/http2_adapter">dio_http2_adapter</a> 提供了一个支持 HTTP/2 的桥接 。</p>
<h4 id="请求取消"><a href="#请求取消" class="headerlink" title="请求取消"></a>请求取消</h4><p>你可以通过 <code>CancelToken</code> 来取消发起的请求。 一个 <code>CancelToken</code> 可以给多个请求共用， 在共用时调用 <code>cancel()</code> 会取消对应的所有请求：</p>
<pre><code>final cancelToken = CancelToken();
dio.get(url, cancelToken: cancelToken).catchError((DioException err) {
  if (CancelToken.isCancel(err)) {
    print('Request canceled: ${err.message}');
  } else {
    // handle error.
  }
});
// Cancel the requests with "cancelled" message.
token.cancel('cancelled');
</code></pre>
<p>完整的示例请参考 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/cancel_request.dart">取消示例</a>.</p>
<h4 id="继承-Dio-class"><a href="#继承-Dio-class" class="headerlink" title="继承 Dio class"></a>继承 Dio class</h4><p><code>Dio</code> 是一个拥有工厂构造函数的接口类，因此不能直接继承 <code>Dio</code>， 但是可以继承 <code>DioForNative</code> 或 <code>DioForBrowser</code>：</p>
<pre><code>import 'package:dio/dio.dart';
import 'package:dio/io.dart';
// 在浏览器中，导入 'package:dio/browser.dart'。

class Http extends DioForNative {
  Http([BaseOptions options]) : super(options) {
    // 构造函数执行
  }
}
</code></pre>
<p>我们也可以直接实现 <code>Dio</code> 接口类 :</p>
<pre><code>class MyDio with DioMixin implements Dio {
  // ...
}
</code></pre>
<h4 id="Web-平台跨域资源共享-CORS"><a href="#Web-平台跨域资源共享-CORS" class="headerlink" title="Web 平台跨域资源共享 (CORS)"></a>Web 平台跨域资源共享 (CORS)</h4><p>在 Web 平台上发送网络请求时，如果请求不是一个 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82">简单请求</a>， 浏览器会自动向服务器发送 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Preflight_request">CORS 预检</a> (Pre-flight requests)， 用于检查服务器是否支持跨域资源共享。</p>
<p>你可以参考简单请求的定义修改你的请求，或者为你的服务加上 CORS 中间件进行跨域处理。</p>

        </div>

        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏
            <div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/custom/donate/AliPay.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/custom/donate/WeChatPay.png"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent">
        </div>
        <!-- 评分 -->
        <div class="single-reward">
          
          <!-- 五星评分 -->
<div id="wpac-rating"></div>
<script type="text/javascript">
wpac_init = window.wpac_init || [];
wpac_init.push({widget: 'Rating', id: 23889});
(function() {
    if ('WIDGETPACK_LOADED' in window) return;
    WIDGETPACK_LOADED = true;
    var mc = document.createElement('script');
    mc.type = 'text/javascript';
    mc.async = true;
    mc.src = 'https://embed.widgetpack.com/widget.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
})();
</script>
<!-- <a target="_blank" rel="noopener" href="https://widgetpack.com" class="wpac-cr">Star Rating WIDGET PACK</a> -->
          
        </div>
        <!-- 自定义署名方式 -->
        <footer class="post-footer">
          <div class="post-lincenses" style="color: #ff9966;">
            欢迎转载，转载时请注明来源哦！
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" style="color: #ff9966;" target="_blank"
              rel="nofollow">
              <i class="fa fa-creative-commons" aria-hidden="true"></i>ncsa4.0</a>
          </div>
          
          <div class="post-tags" style="color: #a39391">
            <span><i class="fa fa-tags"></i>
              
              <a href="/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" style="color: #716e77;">安卓开发<em>·</em></a>
              
            </span>
            <span>
              <i class="iconfont icon-file"></i>
              
              <a href="/categories/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" style="color: #716e77;">安卓开发</a>
              
            </span>
          </div>
          
          <div class="post-share" >
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
        <!-- <div class="tag-cloud">
          <div class="tag-cloud-title">
          </div>
          <div class="tag-cloud-tags">
            <a href="/tags/1/" style="font-size: 10px; color: #f06966">1</a> <a href="/tags/UML/" style="font-size: 10px; color: #f06966">UML</a> <a href="/tags/go/" style="font-size: 12.5px; color: #c27d87">go</a> <a href="/tags/redis/" style="font-size: 15px; color: #9592a7">redis</a> <a href="/tags/sql/" style="font-size: 10px; color: #f06966">sql</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 12.5px; color: #c27d87">中间件</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 15px; color: #9592a7">前端开发小技巧</a> <a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/" style="font-size: 10px; color: #f06966">前端知识</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" style="font-size: 10px; color: #f06966">后端</a> <a href="/tags/%E5%90%8E%E7%AB%AFGo/" style="font-size: 10px; color: #f06966">后端Go</a> <a href="/tags/%E5%90%8E%E7%AB%AFgo/" style="font-size: 10px; color: #f06966">后端go</a> <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 20px; color: #39bae8">后端开发小技巧</a> <a href="/tags/%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%9F%A5%E8%AF%86/" style="font-size: 10px; color: #f06966">后端开发知识</a> <a href="/tags/%E5%90%8E%E7%AB%AF%E7%9F%A5%E8%AF%86/" style="font-size: 17.5px; color: #67a6c8">后端知识</a> <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9F%A5%E8%AF%86/" style="font-size: 10px; color: #f06966">大数据知识</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" style="font-size: 10px; color: #f06966">学习记录</a> <a href="/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" style="font-size: 10px; color: #f06966">安卓开发</a> <a href="/tags/%E6%97%A5%E5%B8%B8/" style="font-size: 10px; color: #f06966">日常</a> <a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 12.5px; color: #c27d87">测试</a> <a href="/tags/%E6%B5%8B%E8%AF%95%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 10px; color: #f06966">测试小技巧</a> <a href="/tags/%E7%94%9F%E6%B4%BB/" style="font-size: 10px; color: #f06966">生活</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 10px; color: #f06966">设计模式</a>
          </div>
        </div> -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
        
        <div class="post-nepre half previous">
          
            <a href="/2024/03/08/Docker/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/loading.jpg" data-src=""
                  style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)"
                  src="">
              </div>
              <span class="label">Previous Post</span>
              <div class="info">
                <h3>Docker基础</h3>
                <hr>
              </div>
            </a>
          </div>
          
          
          
          <div class="post-nepre half next">
            
              <a href="/2024/03/08/Go%E9%9D%A2%E8%AF%95%E9%A2%98/" rel="next">
                <div class="background">
                  <img class="lazyload" src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/loading.jpg" data-src=""
                    style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;"
                    onerror="imgError(this,3)" src="">
                </div>
                <span class="label">Next Post</span>
                <div class="info">
                  <h3>记录我的面试经历</h3>
                  <hr>
                </div>
              </a>
            </div>
            
      </section>
      <!-- 加密文章隐藏评论 -->
      <section class="comment" >
        <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<div id="gitalk-container" class="comment"></div> 
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
<script src="/js/md5.min.js"></script>
<script type="text/javascript">
	var gitalk = new Gitalk({
  	clientID: '',
  	clientSecret: '',
  	repo: 'Kiritoabc.github.io',
  	owner: 'Kiritoabc',
	admin: ['Kiritoabc'],
	distractionFreeMode: 'true',
    id: md5(location.pathname)
})
gitalk.render('gitalk-container') 
</script>

      </section>
      <!-- 加密文章隐藏作者信息 -->
      
    </main><!-- #main -->
  </div><!-- #primary -->
</div>


<!--评论配置-->



      <!-- body.end -->
    </div>
    <!-- search -->    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            // PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- footer-->    
    
    <footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info">
        <div class="footertext">
          <div class="img-preload">
              <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
              <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
          </div>
        </div>
        <!-- 网站数据统计 -->
        <div class="footer-device">
          <p style="font-family: 'Ubuntu', sans-serif;">
            <span style="color: #ff9999;padding-left: 20px;">
                <!-- 网站运行时间统计 -->
                <i class="fa fa-clock-o" aria-hidden="true"></i>
                <span id="time" align="center">载入时间中...</span>
                <script>
                var now = new Date(); 
                function createtime() { 
                      var grt= new Date("Tue Jul 11 2023 17:20:00 GMT+0000 (Coordinated Universal Time)");//在此处修改你的建站时间
                      now.setTime(now.getTime()+250); 
                      days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
                      hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
                      if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
                      mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
                      seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
                      snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
                      document.getElementById("time").innerHTML = "小破站在各种灾难中苟活了 "+ dnum +" 天 "+hnum + " 小时 " + mnum + " 分 " + snum + " 秒";      
                  } 
                  setInterval("createtime()",250);
                </script>
            </span> 
          </p>
        </div>
        <div class="footer-device">
          <p style="font-family: 'Ubuntu', sans-serif;">
            <span style="color: #b9b9b9;padding-left: 20px;">
              <!-- 全网站字数统计wordcount -->
              
              <!-- 不蒜子网页计数器 -->
              
              <span style="padding-left: 20px;"><i class="fa fa-fire" aria-hidden="true" style="color: #ff9999;display:inline-block"></i><span id="busuanzi_container_site_pv">总访问量： <span id="busuanzi_value_site_pv" style="color:#ff9999;"></span>次</span>
              </span>
              
              
              <span style="padding-left: 20px;"><i class="fa fa-user" aria-hidden="true" style="color: #ff9999;display:inline-block"></i><span id="busuanzi_container_site_uv">总访问人数： <span id="busuanzi_value_site_uv" style="color:#ff9999;"></span>人</span>
              </span>
              
            </span>
          </p>
        </div>
        <!-- 作者注明 -->
        <div class="footer-device">
          <p style="font-family: 'Ubuntu', sans-serif;">
              <span style="color: #b9b9b9;">
                Copyright &copy; 2024
                &nbsp;<a style="color: #ff9999;display:inline-block"> 菠萝 </a>
                &nbsp;<i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> 
                &nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank" style="color: #ff9999;display:inline-block">Hexo</a>
                |&nbsp;Theme&nbsp;<a href="https://gitee.com/cungudafa/hexo-theme-sakuraplus" target="_blank" style="color: #ff9999;display:inline-block">SakuraPlus</a>
              </span>
          </p>
        </div>
         <!-- 网站作者版权注明 -->
         
          <div id="footer-info" class="inner">
            <p style="font-family: 'Ubuntu', sans-serif;">
              <span style="color: #ff9999;">
                
              </span>
            </p>
          </div>
        
    </div><!-- .site-info -->
</footer>


<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cungudafa/cdn/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cungudafa/cdn/js/InsightSearch.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cungudafa/cdn/js/sakura-app.js"></script>


<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- fancybox大图查看 需jq -->

  <script type="text/javascript" src="https://cdn.jsdelivr.net/gh/cungudafa/cdn/js/jquery.fancybox.min.js"></script>
  <script>
    $('[data-fancybox="images"]').fancybox({
      thumbs : {
        autoStart : true //缩略图
      }
    });
    $('[data-fancybox]').fancybox({
      protect: true,//图片右键不能下载
      youtube : {
          controls : 0,
          showinfo : 0
      },
      vimeo : {
          color : 'f00'
      }
    });
  </script>


<!-- 自适应浏览器 -->
<script type="text/javascript">
  /* <![CDATA[ */
  if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
    var Poi = {"pjax":"0","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
  } else {
    var Poi = {"pjax":"0","movies":{"url": "https://cdn.jsdelivr.net/gh/honjun/hojun@1.2","name":"Unbroken.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
  }
  /* ]]> */
  
  </script>
  <script>
  $(document).ready(function() {
    if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
      if ($(".pattern-center").length > 0) { //有图的情况
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: '.toc', // 放置目录的容器
            // Where to grab the headings to build the table of contents.
            contentSelector: '.entry-content', // 正文内容所在
            // Which headings to grab inside of the contentSelector element.
            scrollSmooth: true,
            headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
            headingsOffset: -400,
            scrollSmoothOffset: -85
        });
      } else {
        tocbot.init({
            // Where to render the table of contents.
            tocSelector: '.toc', // 放置目录的容器
            // Where to grab the headings to build the table of contents.
            contentSelector: '.entry-content', // 正文内容所在
            // Which headings to grab inside of the contentSelector element.
            scrollSmooth: true,
            headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
            headingsOffset: -85,
            scrollSmoothOffset: -85
        });
      }
      var offsetTop = $('.toc').offset().top - 95;
      window.onscroll = function() {
        var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
        if (scrollTop >= offsetTop) {
          $('.toc').addClass('toc-fixed');
        } else {
          $('.toc').removeClass('toc-fixed');
        }
      }
    }
  });
  </script>
    <!-- Side menu -->
    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <!-- Floating window -->
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/header.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">菠箩箩の小破站</p>
  <p style="text-align: center; word-spacing: 20px;">
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/analytics/">
                  <i class="fa fa-line-chart" aria-hidden="true"></i>
                  统计
                </a>
              </li>
            
              <li>
                <a href="/tags">
                  <i class="fa fa-tags" aria-hidden="true"></i>
                  标签
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            友人帐
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2020 hexo-sakuraplus</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  
   <!-- pages壁纸切换 -->
 
    <div class="skin-menu no-select" id="mainskin"  style="position: fixed">
        <div class="theme-controls row-container">
            <ul class="menu-list">
                <li id="white-bg"> <i class="fa fa-television" aria-hidden="true"></i></li>
                <li id="sakura-bg"> <i class="iconfont icon-sakura"></i></li>
                <li id="gribs-bg"> <i class="fa fa-slack" aria-hidden="true"></i></li>
                <li id="KAdots-bg"> <i class="iconfont icon-dots"></i></li>
                <li id="totem-bg"> <i class="fa fa-optin-monster" aria-hidden="true"></i></li>
                <li id="pixiv-bg"> <i class="iconfont icon-pixiv"></i></li>
                <li id="bing-bg"> <i class="iconfont icon-bing"></i></li>
                <li id="dark-bg"> <i class="fa fa-moon-o" aria-hidden="true"></i></li>
            </ul>
        </div>
        <div class="font-family-controls row-container">
            <button type="button" class="control-btn-serif selected" data-mode="serif" onclick="mashiro_global.font_control.change_font()">Serif</button>
            <button type="button" class="control-btn-sans-serif" data-mode="sans-serif" onclick="mashiro_global.font_control.change_font()">Sans Serif</button>
        </div>
    </div>   
    <canvas id="night-mode-cover"></canvas> 
        <div class="changeSkin-gear no-select">
        <div class="keys" id="setbtn"> <span id="open-skinMenu"> 切换壁纸 | SCHEME TOOL 
            &nbsp;<i class="iconfont icon-gear inline-block rotating"></i> </span></div>
    </div><!-- skin.end -->

  <!-- left side bar -->

 </body>
</html>