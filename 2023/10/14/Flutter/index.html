<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>flutter | 菠萝萝のBLOG</title><meta name="keywords" content="安卓开发"><meta name="author" content="菠萝"><meta name="copyright" content="菠萝"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="flutter"><meta name="application-name" content="flutter"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="flutter"><meta property="og:url" content="https://kiritoabc.github.io/2023/10/14/Flutter/index.html"><meta property="og:site_name" content="菠萝萝のBLOG"><meta property="og:description" content="flutter网络框架dio v5.3.3 dio 是一个强大的 HTTP 网络请求库，支持全局配置、Restful API、FormData、拦截器、 请求取消、Cookie 管理、文件上传&amp;#x2F;下载、超时、自定义适配器、转换器等。    入门使用添加依赖 flutter pub add d"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover3.jpg?_r_=755eab4a-4e60-74b4-9c99-9928f1c2f75c"><meta property="article:author" content="菠萝"><meta property="article:tag" content="博客, 菠萝, 菠萝的博客, 菠萝的BLOG"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover3.jpg?_r_=755eab4a-4e60-74b4-9c99-9928f1c2f75c"><meta name="description" content="flutter网络框架dio v5.3.3 dio 是一个强大的 HTTP 网络请求库，支持全局配置、Restful API、FormData、拦截器、 请求取消、Cookie 管理、文件上传&amp;#x2F;下载、超时、自定义适配器、转换器等。    入门使用添加依赖 flutter pub add d"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/菠萝.png"><link rel="canonical" href="https://kiritoabc.github.io/2023/10/14/Flutter/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 菠萝","link":"链接: ","source":"来源: 菠萝萝のBLOG","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '菠萝萝のBLOG',
  title: 'flutter',
  postAI: '',
  pageFillDescription: 'flutter, 网络框架dio v5.3.3, 入门使用, Dio APIs, 创建一个Dio实例并配置它, 请求配置, 响应数据, 拦截器, 完成和终止请求x2F响应, 日志拦截器, Dart, Flutter, 自定义拦截器, 错误处理, DioException, 使用 applicationx2Fx-www-form-urlencoded 编码, , , 复用 FormData 和 MultipartFile, 转换器, 在 Flutter 中进行设置, 其它示例, HttpClientAdapter, , , , 请求取消, 继承 Dio class, Web 平台跨域资源共享 (CORS)网络框架是一个强大的网络请求库支持全局配置拦截器请求取消管理文件上传下载超时自定义适配器转换器等入门使用添加依赖使用请求请求发起多个并发的请求下载文件以流的方式接收响应数据设置接收类型为响应流以二进制数组的方式接收响应数据设置接收类型为类型发送通过上传多个文件监听发送上传数据进度以流的形式提交二进制数据构建设置创建一个实例并配置它建议在项目中使用单例这样便可对同一个实例发起的所有请求进行一些统一的配置比如设置公共请求基地址超时时间等这里有一个在工程中使用单例定义为变量的示例供开发者参考你可以使用默认配置或传递一个可选参数来创建一个实例的核心是请求配置描述的是实例发起网络请求的的公共配置而描述了每一个请求的配置信息每一次请求都可以单独配置单次请求的中的配置信息可以覆盖中的配置下面是的配置项请求方式请求基本地址可以包含路径例如请求头连接服务器超时时间两次数据流数据接收的最长间隔时间注意不是请求的最长接收时间请求内容体可以是任意类型请求路径如果以开始则会被忽略否则将会和拼接出完整的地址请求的默认值会由根据请求载荷类型进行推导可以调用进行移除如果你想以格式编码请求数据可以设置此选项为会自动编码请求体期望以哪种格式方式接受响应数据包括和默认值是当响应头中为时会自动将响应内容转化为对象如果想以二进制方式接受响应数据如下载一个二进制文件那么可以使用如果想以文本字符串格式接收响应数据请使用决定响应状态码是否被视为请求成功返回请求结果就会按成功处理否则会按失败处理用户自定义字段可以在和中依次传递请求地址的参数请求数据中数组的编码的方式默认值为响应数据当请求成功时会返回一个对象它包含如下字段响应数据可能已经被转换了类型详情请参考响应对应的请求配置响应的状态码响应对应状态码的详情信息响应是否被重定向请求连接经过的重定向列表如果请求未经过重定向则列表为空在中构造的自定义字段响应对应的头数据请求成功后你可以访问到下列字段注意与是不同的实例互相之间无关拦截器每个实例都可以添加任意多个拦截器他们会组成一个队列拦截器队列的执行顺序是先进先出通过使用拦截器你可以在请求之前响应之后和发生异常时未被或处理做一些统一的预处理操作如果你想完成请求并返回一些自定义数据你可以使用如果你想终止请求并触发一个错误你可以使用如果你想终止请求并触发一个错误你可以使用如果你想完成请求并返回一些自定义数据你可以使用一个简单的自定义拦截器示例完成和终止请求响应在所有拦截器中你都可以改变请求执行流如果你想完成请求响应并返回自定义数据你可以一个对象或返回的结果如果你想终止触发一个错误上层会被调用一个请求响应那么可以一个对象或返回的结果如果同时发起多个网络请求则它们是可以同时进入的并行的而提供了一种串行机制它可以保证请求进入拦截器时是串行的前面的执行完后后面的才会进入拦截器假设这么一个场景出于安全原因我们需要给所有的请求头中添加一个如果不存在我们先去请求获取到后再重试假设刚开始的时候为如果允许请求并发则这些并发请求并行进入拦截器时都为所以它们都需要去请求这会导致被请求多次为了避免不必要的重复请求可以使用这样只需要第一个请求处理一次即可完整的示例代码请点击这里日志拦截器我们可以添加拦截器来自动打印请求和响应等日志注意应该保持最后一个被添加到拦截器中否则在它之后进行处理的拦截器修改的内容将无法体现不输出响应内容体注意默认的只会在模式启用了断言的情况下输出日志你也可以使用中的来输出日志在中也可以使用在中你应该使用来打印日志这样也会让调试日志能够通过获取到注意的意义不是只在模式下打印而是对输出内容进行节流从而保证输出完整请不要在生产模式使用除非你有意输出相关日志自定义拦截器开发者可以通过继承类来实现自定义拦截器这是一个简单的缓存拦截器错误处理当请求过程中发生错误时会将包装成一个错误的请求对应的配置错误的请求对应的响应内容如果请求未完成响应内容可能为空错误的类型实际错误的内容实际错误的堆栈错误信息使用编码默认情况下会将请求数据除了类型序列化为如果想要以格式编码你可以设置发送支持发送请求数据将会以方式编码中可以包含一个或多个文件通常情况下只有方法支持发送这里有一个完整的示例多文件上传多文件上传时通过给加中括号方式作为文件数组的标记大多数后台也会通过来读取多个文件然而标准中并没有规定多文件上传必须要使用关键在于后台与客户端之间保持一致最终编码时会会为如果不想添加可以通过的来构建复用和如果你在重复调用的请求中使用或者确保你每次使用的都是新实例常见的错误做法是将赋值给一个共享变量在每次请求中都使用这个变量这样的操作会加大无法序列化的错误出现的可能性你可以像以下的代码一样编写你的请求以避免出现这样的错误转换器转换器用于对请求数据和响应数据进行编解码处理实现了一个默认转换器如果你想对请求和响应数据进行自定义编解码处理可以提供自定义转换器并通过设置只在方法中生效只有这些方法可以使用请求内容体但是可以用于所有请求方法的返回数据在中进行设置如果你在开发应用强烈建议通过在单独的中进行解码从而避免在解析复杂时导致的卡顿自定义其它示例这里有一个自定义的示例是和之间的桥梁实现了一套标准且强大的而则是真正发起请求的对象我们通过将和解耦这样一来便可以自由定制请求的底层实现使用作为原生平台默认的桥梁作为平台的桥梁你可以通过来根据平台创建它们如果你需要单独使用对应平台的适配器对于平台对于原生平台示例中包含了一个简单的自定义桥接设置代理提供了一个回调来设置底层的代理将请求代理至请注意代理会在你正在运行应用的设备上生效而不是在宿主平台生效完整的示例请查看这里平台不支持设置代理证书校验证书验证或公钥固定是指确保端侧与服务器的连接的证书是期望的证书从而减少中间人攻击的机会中解释了该理论服务器响应证书与其他方法不同此方法使用服务器本身的证书你可以使用读取密钥的证书颁发机构验证当您的服务器具有自签名证书时可以用下面的方法但它们不适用于或等第三方颁发的证书有两种方法可以校验证书假设我们的后台服务使用的是自签名证书证书格式是格式我们将证书的内容保存在本地字符串中那么我们的校验逻辑如下对于自签名的证书我们也可以将其添加到本地证书信任链中这样证书验证时就会自动通过而不会再走到回调中注意通过设置的证书格式必须为或如果证书格式为则需将证书密码传入这样则会在代码中暴露证书密码所以客户端证书校验不建议使用格式的证书支持提供了一个支持的桥接请求取消你可以通过来取消发起的请求一个可以给多个请求共用在共用时调用会取消对应的所有请求完整的示例请参考取消示例继承是一个拥有工厂构造函数的接口类因此不能直接继承但是可以继承或在浏览器中导入构造函数执行我们也可以直接实现接口类平台跨域资源共享在平台上发送网络请求时如果请求不是一个简单请求浏览器会自动向服务器发送预检用于检查服务器是否支持跨域资源共享你可以参考简单请求的定义修改你的请求或者为你的服务加上中间件进行跨域处理',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-05-19 01:13:25',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/avatar1.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://Kiritoabc.github.io" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">菠萝萝のBLOG</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CSAPP/" style="font-size: 1.05rem;">CSAPP<sup>1</sup></a><a href="/tags/Goguide/" style="font-size: 1.05rem;">Goguide<sup>2</sup></a><a href="/tags/SQL/" style="font-size: 1.05rem;">SQL<sup>1</sup></a><a href="/tags/UML/" style="font-size: 1.05rem;">UML<sup>1</sup></a><a href="/tags/golang/" style="font-size: 1.05rem;">golang<sup>8</sup></a><a href="/tags/redis/" style="font-size: 1.05rem;">redis<sup>3</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>1</sup></a><a href="/tags/why-what-how/" style="font-size: 1.05rem;">why? what? how?<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 1.05rem;">中间件<sup>4</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>3</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 1.05rem;">分布式<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 1.05rem;">前端开发小技巧<sup>2</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">前端知识<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.05rem;">博客<sup>1</sup></a><a href="/tags/%E5%90%8E%E7%AB%AF%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">后端知识<sup>2</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80zhi-sh/" style="font-size: 1.05rem;">基础zhi'sh<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9F%A5%E8%AF%86/" style="font-size: 1.05rem;">大数据知识<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" style="font-size: 1.05rem;">学习记录<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" style="font-size: 1.05rem;">安卓开发<sup>1</sup></a><a href="/tags/%E6%9C%BA%E8%80%83/" style="font-size: 1.05rem;">机考<sup>1</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 1.05rem;">架构<sup>1</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 1.05rem;">测试<sup>2</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 1.05rem;">测试小技巧<sup>1</sup></a><a href="/tags/%E7%94%9F%E6%B4%BB%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 1.05rem;">生活小技巧<sup>1</sup></a><a href="/tags/%E7%AE%80%E5%8E%86%E5%88%B6%E4%BD%9C/" style="font-size: 1.05rem;">简历制作<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 1.05rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%AF%BB%E4%B9%A6%E8%AE%B0%E5%BD%95/" style="font-size: 1.05rem;">读书记录<sup>1</sup></a><a href="/tags/%E9%9D%A2%E7%BB%8F/" style="font-size: 1.05rem;">面经<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>1</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" style="font-size: 1.05rem;">项目管理<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">五月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">四月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/03/"><span class="card-archive-list-date">三月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/12/"><span class="card-archive-list-date">十二月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">8</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">十月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">九月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/08/"><span class="card-archive-list-date">八月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url">前端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>安卓开发</span></a></span></div></div><h1 class="post-title" itemprop="name headline">flutter</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-10-14T13:04:41.000Z" title="发表于 2023-10-14 13:04:41">2023-10-14</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-05-19T01:13:25.425Z" title="更新于 2024-05-19 01:13:25">2024-05-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">4.6k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="flutter"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为杭州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>杭州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover3.jpg?_r_=755eab4a-4e60-74b4-9c99-9928f1c2f75c"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://kiritoabc.github.io/2023/10/14/Flutter/"><header><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/" itemprop="url">前端</a><a href="/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" tabindex="-1" itemprop="url">安卓开发</a><h1 id="CrawlerTitle" itemprop="name headline">flutter</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">菠萝</span><time itemprop="dateCreated datePublished" datetime="2023-10-14T13:04:41.000Z" title="发表于 2023-10-14 13:04:41">2023-10-14</time><time itemprop="dateCreated datePublished" datetime="2024-05-19T01:13:25.425Z" title="更新于 2024-05-19 01:13:25">2024-05-19</time></header><h1 id="flutter"><a href="#flutter" class="headerlink" title="flutter"></a>flutter</h1><h2 id="网络框架dio-v5-3-3"><a href="#网络框架dio-v5-3-3" class="headerlink" title="网络框架dio v5.3.3"></a>网络框架dio v5.3.3</h2><blockquote>
<p>dio 是一个强大的 HTTP 网络请求库，支持全局配置、Restful API、FormData、拦截器、 请求取消、Cookie 管理、文件上传&#x2F;下载、超时、自定义适配器、转换器等。</p>
</blockquote>
<span id="more"></span>

<h3 id="入门使用"><a href="#入门使用" class="headerlink" title="入门使用"></a>入门使用</h3><p>添加依赖</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">flutter pub add dio</span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dio/dio.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> dio = Dio();</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> getHttp() <span class="keyword">async</span> &#123;</span><br><span class="line">  <span class="keyword">final</span> response = <span class="keyword">await</span> dio.<span class="keyword">get</span>(<span class="string">&#x27;https://dart.dev&#x27;</span>);</span><br><span class="line">  <span class="built_in">print</span>(response);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>GET请求</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dio/dio.dart&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> dio = Dio();</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> request() <span class="keyword">async</span> &#123;</span><br><span class="line">  Response response;</span><br><span class="line">  response = <span class="keyword">await</span> dio.<span class="keyword">get</span>(<span class="string">&#x27;/test?id=12&amp;name=dio&#x27;</span>);</span><br><span class="line">  <span class="built_in">print</span>(response.data.toString());</span><br><span class="line">  <span class="comment">// The below request is the same as above.</span></span><br><span class="line">  response = <span class="keyword">await</span> dio.<span class="keyword">get</span>(</span><br><span class="line">    <span class="string">&#x27;/test&#x27;</span>,</span><br><span class="line">    queryParameters: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">12</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;dio&#x27;</span>&#125;,</span><br><span class="line">  );</span><br><span class="line">  <span class="built_in">print</span>(response.data.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>POST请求</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">response = <span class="keyword">await</span> dio.post(<span class="string">&#x27;/test&#x27;</span>, data: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">12</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;dio&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>发起多个并发的请求</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">response = <span class="keyword">await</span> Future.wait([dio.post(<span class="string">&#x27;/info&#x27;</span>), dio.<span class="keyword">get</span>(<span class="string">&#x27;/token&#x27;</span>)]);</span><br></pre></td></tr></table></figure>

<p><strong>下载文件</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">response = <span class="keyword">await</span> dio.download(</span><br><span class="line">  <span class="string">&#x27;https://www.google.com/&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;<span class="subst">$&#123;(await getTemporaryDirectory()).path&#125;</span>google.html&#x27;</span>,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>以流的方式接收响应数据：</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> rs = <span class="keyword">await</span> dio.<span class="keyword">get</span>(</span><br><span class="line">  url,</span><br><span class="line">  options: Options(responseType: ResponseType.stream), <span class="comment">// 设置接收类型为 `stream`</span></span><br><span class="line">);</span><br><span class="line"><span class="built_in">print</span>(rs.data.stream); <span class="comment">// 响应流</span></span><br></pre></td></tr></table></figure>

<p><strong>以二进制数组的方式接收响应数据：</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> rs = <span class="keyword">await</span> dio.<span class="keyword">get</span>(</span><br><span class="line">  url,</span><br><span class="line">  options: Options(responseType: ResponseType.bytes), <span class="comment">// 设置接收类型为 `bytes`</span></span><br><span class="line">);</span><br><span class="line"><span class="built_in">print</span>(rs.data); <span class="comment">// 类型: List&lt;int&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>发送 <code>FormData</code>:</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> formData = FormData.fromMap(&#123;</span><br><span class="line">  <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;dio&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;date&#x27;</span>: <span class="built_in">DateTime</span>.now().toIso8601String(),</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">final</span> response = <span class="keyword">await</span> dio.post(<span class="string">&#x27;/info&#x27;</span>, data: formData);</span><br></pre></td></tr></table></figure>

<p><strong>通过 <code>FormData</code> 上传多个文件:</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> formData = FormData.fromMap(&#123;</span><br><span class="line">  <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;dio&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;date&#x27;</span>: <span class="built_in">DateTime</span>.now().toIso8601String(),</span><br><span class="line">  <span class="string">&#x27;file&#x27;</span>: <span class="keyword">await</span> MultipartFile.fromFile(<span class="string">&#x27;./text.txt&#x27;</span>, filename: <span class="string">&#x27;upload.txt&#x27;</span>),</span><br><span class="line">  <span class="string">&#x27;files&#x27;</span>: [</span><br><span class="line">    <span class="keyword">await</span> MultipartFile.fromFile(<span class="string">&#x27;./text1.txt&#x27;</span>, filename: <span class="string">&#x27;text1.txt&#x27;</span>),</span><br><span class="line">    <span class="keyword">await</span> MultipartFile.fromFile(<span class="string">&#x27;./text2.txt&#x27;</span>, filename: <span class="string">&#x27;text2.txt&#x27;</span>),</span><br><span class="line">  ]</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">final</span> response = <span class="keyword">await</span> dio.post(<span class="string">&#x27;/info&#x27;</span>, data: formData);</span><br></pre></td></tr></table></figure>

<p><strong>监听发送（上传）数据进度:</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> response = <span class="keyword">await</span> dio.post(</span><br><span class="line">  <span class="string">&#x27;https://www.dtworkroom.com/doris/1/2.0.0/test&#x27;</span>,</span><br><span class="line">  data: &#123;<span class="string">&#x27;aa&#x27;</span>: <span class="string">&#x27;bb&#x27;</span> * <span class="number">22</span>&#125;,</span><br><span class="line">  onSendProgress: (<span class="built_in">int</span> sent, <span class="built_in">int</span> total) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;<span class="subst">$sent</span> <span class="subst">$total</span>&#x27;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><strong>以流的形式提交二进制数据：</strong></p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Binary data</span></span><br><span class="line"><span class="keyword">final</span> postData = &lt;<span class="built_in">int</span>&gt;[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>];</span><br><span class="line"><span class="keyword">await</span> dio.post(</span><br><span class="line">  url,</span><br><span class="line">  data: Stream.fromIterable(postData.map((e) =&gt; [e])), <span class="comment">// 构建 Stream&lt;List&lt;int&gt;&gt;</span></span><br><span class="line">  options: Options(</span><br><span class="line">    headers: &#123;</span><br><span class="line">      Headers.contentLengthHeader: postData.length, <span class="comment">// 设置 content-length.</span></span><br><span class="line">    &#125;,</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h3 id="Dio-APIs"><a href="#Dio-APIs" class="headerlink" title="Dio APIs"></a>Dio APIs</h3><h4 id="创建一个Dio实例并配置它"><a href="#创建一个Dio实例并配置它" class="headerlink" title="创建一个Dio实例并配置它"></a>创建一个Dio实例并配置它</h4><blockquote>
<p>建议在项目中使用Dio单例，这样便可对同一个dio实例发起的所有请求进行一些统一的配置， 比如设置公共header、请求基地址、超时时间等。 这里有一个在<a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example_flutter_app">Flutter工程中使用Dio单例</a> （定义为top level变量）的示例供开发者参考。</p>
</blockquote>
<p>你可以使用默认配置或传递一个可选 <code>BaseOptions</code>参数来创建一个Dio实例 :</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> dio = Dio(); <span class="comment">// With default `Options`.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> configureDio() &#123;</span><br><span class="line">  <span class="comment">// Update default configs.</span></span><br><span class="line">  dio.options.baseUrl = <span class="string">&#x27;https://api.pub.dev&#x27;</span>;</span><br><span class="line">  dio.options.connectTimeout = <span class="built_in">Duration</span>(seconds: <span class="number">5</span>);</span><br><span class="line">  dio.options.receiveTimeout = <span class="built_in">Duration</span>(seconds: <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Or create `Dio` with a `BaseOptions` instance.</span></span><br><span class="line">  <span class="keyword">final</span> options = BaseOptions(</span><br><span class="line">    baseUrl: <span class="string">&#x27;https://api.pub.dev&#x27;</span>,</span><br><span class="line">    connectTimeout: <span class="built_in">Duration</span>(seconds: <span class="number">5</span>),</span><br><span class="line">    receiveTimeout: <span class="built_in">Duration</span>(seconds: <span class="number">3</span>),</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">final</span> anotherDio = Dio(options);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Dio 的核心 API 是：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">Future&lt;Response&lt;T&gt;&gt; request&lt;T&gt;(</span><br><span class="line">  <span class="built_in">String</span> path, &#123;</span><br><span class="line">  <span class="built_in">Object?</span> data,</span><br><span class="line">  <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? queryParameters,</span><br><span class="line">  CancelToken? cancelToken,</span><br><span class="line">  Options? options,</span><br><span class="line">  ProgressCallback? onSendProgress,</span><br><span class="line">  ProgressCallback? onReceiveProgress,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> response = <span class="keyword">await</span> dio.request(</span><br><span class="line">  <span class="string">&#x27;/test&#x27;</span>,</span><br><span class="line">  data: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">12</span>, <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;dio&#x27;</span>&#125;,</span><br><span class="line">  options: Options(method: <span class="string">&#x27;GET&#x27;</span>),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="请求配置"><a href="#请求配置" class="headerlink" title="请求配置"></a>请求配置</h4><p><code>BaseOptions</code> 描述的是 Dio 实例发起网络请求的的公共配置， 而 <code>Options</code> 描述了每一个Http请求的配置信息，每一次请求都可以单独配置， 单次请求的 <code>Options</code> 中的配置信息可以覆盖 <code>BaseOptions</code> 中的配置。 下面是 <code>Options</code> 的配置项：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// <span class="language-markdown">请求方式。</span></span></span><br><span class="line"><span class="built_in">String</span> method;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">请求基本地址，可以包含路径例如 https://dart.dev/api/。</span></span></span><br><span class="line"><span class="built_in">String?</span> baseUrl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">HTTP 请求头。</span></span></span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? headers;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">连接服务器超时时间.</span></span></span><br><span class="line"><span class="built_in">Duration?</span> connectTimeout;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">两次数据流数据接收的最长间隔时间，注意不是请求的最长接收时间。</span></span></span><br><span class="line"><span class="built_in">Duration?</span> receiveTimeout;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">请求内容体，可以是任意类型。</span></span></span><br><span class="line"><span class="built_in">dynamic</span> data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">请求路径，如果以 http(s)开始, 则 [baseURL] 会被忽略，</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">否则将会和 [baseUrl] 拼接出完整的地址。</span></span></span><br><span class="line"><span class="built_in">String</span> path = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">请求的 Content-Type。</span></span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">默认值会由 [ImplyContentTypeInterceptor] 根据请求载荷类型进行推导。</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">可以调用 [Interceptors.removeImplyContentTypeInterceptor] 进行移除。</span></span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">如果你想以 <span class="code">`application/x-www-form-urlencoded`</span> 格式编码请求数据,</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">可以设置此选项为 <span class="code">`Headers.formUrlEncodedContentType`</span>,</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">[Dio] 会自动编码请求体。</span></span></span><br><span class="line"><span class="built_in">String?</span> contentType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">期望以哪种格式（方式）接受响应数据，包括 <span class="code">`json`</span>、<span class="code">`stream`</span> 和 <span class="code">`plain`</span>。</span></span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">默认值是 <span class="code">`json`</span>, 当响应头中 content-type 为 <span class="code">`application/json`</span> 时，</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">dio 会自动将响应内容转化为 json 对象。</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">如果想以二进制方式接受响应数据，如下载一个二进制文件，那么可以使用 <span class="code">`stream`</span>。</span></span></span><br><span class="line"><span class="comment">///</span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">如果想以文本（字符串）格式接收响应数据，请使用 <span class="code">`plain`</span>。</span></span></span><br><span class="line">ResponseType? responseType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown"><span class="code">`validateStatus`</span> 决定 HTTP 响应状态码是否被视为请求成功，</span></span></span><br><span class="line"><span class="comment">/// <span class="language-markdown">返回 <span class="code">`true`</span> 请求结果就会按成功处理，否则会按失败处理.</span></span></span><br><span class="line">ValidateStatus? validateStatus;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">用户自定义字段，可以在 [Interceptor]、[Transformer] 和 [Response] 中依次传递。</span></span></span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt;? extra;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">请求地址的参数。</span></span></span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span> <span class="comment">/*String|Iterable&lt;String&gt;*/</span> &gt;? queryParameters;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">请求数据中数组的编码的方式，默认值为 <span class="code">`multiCompatible`</span>。</span></span></span><br><span class="line">ListFormat? listFormat;</span><br></pre></td></tr></table></figure>

<h4 id="响应数据"><a href="#响应数据" class="headerlink" title="响应数据"></a>响应数据</h4><p>当请求成功时会返回一个Response对象，它包含如下字段：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// <span class="language-markdown">响应数据。可能已经被转换了类型, 详情请参考 [ResponseType]。</span></span></span><br><span class="line">T? data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">响应对应的请求配置。</span></span></span><br><span class="line">RequestOptions requestOptions;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">响应的 HTTP 状态码。</span></span></span><br><span class="line"><span class="built_in">int?</span> statusCode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">响应对应状态码的详情信息。</span></span></span><br><span class="line"><span class="built_in">String?</span> statusMessage;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">响应是否被重定向</span></span></span><br><span class="line"><span class="built_in">bool</span> isRedirect;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">请求连接经过的重定向列表。如果请求未经过重定向，则列表为空。</span></span></span><br><span class="line"><span class="built_in">List</span>&lt;RedirectRecord&gt; redirects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">在 [RequestOptions] 中构造的自定义字段。</span></span></span><br><span class="line"><span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">dynamic</span>&gt; extra;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">响应对应的头数据。</span></span></span><br><span class="line">Headers headers;</span><br></pre></td></tr></table></figure>

<p>请求成功后，你可以访问到下列字段：</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">final</span> response = <span class="keyword">await</span> dio.<span class="keyword">get</span>(<span class="string">&#x27;https://pub.dev&#x27;</span>);</span><br><span class="line"><span class="built_in">print</span>(response.data);</span><br><span class="line"><span class="built_in">print</span>(response.headers);</span><br><span class="line"><span class="built_in">print</span>(response.requestOptions);</span><br><span class="line"><span class="built_in">print</span>(response.statusCode);</span><br></pre></td></tr></table></figure>

<p>注意，<code>Response.extra</code> 与 <code>RequestOptions.extra</code> 是不同的实例，互相之间无关。</p>
<h4 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h4><p>每个 Dio 实例都可以添加任意多个拦截器，他们会组成一个队列，拦截器队列的执行顺序是先进先出。 通过使用拦截器，你可以在请求之前、响应之后和发生异常时（未被 <code>then</code> 或 <code>catchError</code> 处理） 做一些统一的预处理操作。</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">dio.interceptors.add(</span><br><span class="line">  InterceptorsWrapper(</span><br><span class="line">    onRequest: (RequestOptions options, RequestInterceptorHandler handler) &#123;</span><br><span class="line">      <span class="comment">// 如果你想完成请求并返回一些自定义数据，你可以使用 `handler.resolve(response)`。</span></span><br><span class="line">      <span class="comment">// 如果你想终止请求并触发一个错误，你可以使用 `handler.reject(error)`。</span></span><br><span class="line">      <span class="keyword">return</span> handler.next(options);</span><br><span class="line">    &#125;,</span><br><span class="line">    onResponse: (Response response, ResponseInterceptorHandler handler) &#123;</span><br><span class="line">      <span class="comment">// 如果你想终止请求并触发一个错误，你可以使用 `handler.reject(error)`。</span></span><br><span class="line">      <span class="keyword">return</span> handler.next(response);</span><br><span class="line">    &#125;,</span><br><span class="line">    onError: (DioException e, ErrorInterceptorHandler handler) &#123;</span><br><span class="line">      <span class="comment">// 如果你想完成请求并返回一些自定义数据，你可以使用 `handler.resolve(response)`。</span></span><br><span class="line">      <span class="keyword">return</span> handler.next(e);</span><br><span class="line">    &#125;,</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>一个简单的自定义拦截器示例:</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;package:dio/dio.dart&#x27;</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CustomInterceptors</span> <span class="keyword">extends</span> <span class="title">Interceptor</span> </span>&#123;</span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onRequest(RequestOptions options, RequestInterceptorHandler handler) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;REQUEST[<span class="subst">$&#123;options.method&#125;</span>] =&gt; PATH: <span class="subst">$&#123;options.path&#125;</span>&#x27;</span>);</span><br><span class="line">    <span class="keyword">super</span>.onRequest(options, handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  <span class="keyword">void</span> onResponse(Response response, ResponseInterceptorHandler handler) &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;RESPONSE[<span class="subst">$&#123;response.statusCode&#125;</span>] =&gt; PATH: <span class="subst">$&#123;response.requestOptions.path&#125;</span>&#x27;</span>);</span><br><span class="line">    <span class="keyword">super</span>.onResponse(response, handler);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@override</span></span><br><span class="line">  Future onError(DioException err, ErrorInterceptorHandler handler) <span class="keyword">async</span> &#123;</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ERROR[<span class="subst">$&#123;err.response?.statusCode&#125;</span>] =&gt; PATH: <span class="subst">$&#123;err.requestOptions.path&#125;</span>&#x27;</span>);</span><br><span class="line">    <span class="keyword">super</span>.onError(err, handler);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="完成和终止请求-响应"><a href="#完成和终止请求-响应" class="headerlink" title="完成和终止请求&#x2F;响应"></a>完成和终止请求&#x2F;响应</h4><p>在所有拦截器中，你都可以改变请求执行流， 如果你想完成请求&#x2F;响应并返回自定义数据，你可以 resolve 一个 <code>Response</code> 对象 或返回 <code>handler.resolve(data)</code> 的结果。 如果你想终止（触发一个错误，上层 <code>catchError</code> 会被调用）一个请求&#x2F;响应， 那么可以 reject 一个<code>DioException</code> 对象或返回 <code>handler.reject(errMsg)</code> 的结果。</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">dio.interceptors.add(</span><br><span class="line">  InterceptorsWrapper(</span><br><span class="line">    onRequest: (options, handler) &#123;</span><br><span class="line">      <span class="keyword">return</span> handler.resolve(</span><br><span class="line">        Response(requestOptions: options, data: <span class="string">&#x27;fake data&#x27;</span>),</span><br><span class="line">      );</span><br><span class="line">    &#125;,</span><br><span class="line">  ),</span><br><span class="line">);</span><br><span class="line"><span class="keyword">final</span> response = <span class="keyword">await</span> dio.<span class="keyword">get</span>(<span class="string">&#x27;/test&#x27;</span>);</span><br><span class="line"><span class="built_in">print</span>(response.data); <span class="comment">// &#x27;fake data&#x27;</span></span><br></pre></td></tr></table></figure>

<p>如果同时发起多个网络请求，则它们是可以同时进入<code>Interceptor</code> 的（并行的）， 而 <code>QueuedInterceptor</code> 提供了一种串行机制： 它可以保证请求进入拦截器时是串行的（前面的执行完后后面的才会进入拦截器）。</p>
<p>假设这么一个场景：出于安全原因，我们需要给所有的请求头中添加一个 <code>csrfToken</code>， 如果 <code>csrfToken</code> 不存在，我们先去请求 <code>csrfToken</code>，获取到 <code>csrfToken</code> 后再重试。 假设刚开始的时候 <code>csrfToken</code> 为 null，如果允许请求并发，则这些并发请求并行进入拦截器时 <code>csrfToken</code> 都为 null，所以它们都需要去请求 <code>csrfToken</code>，这会导致 <code>csrfToken</code> 被请求多次。 为了避免不必要的重复请求，可以使用 <code>QueuedInterceptor</code>， 这样只需要第一个请求处理一次即可。</p>
<p>完整的示例代码请点击 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/queued_interceptor_crsftoken.dart">这里</a>.</p>
<h4 id="日志拦截器"><a href="#日志拦截器" class="headerlink" title="日志拦截器"></a>日志拦截器</h4><p>我们可以添加 <code>LogInterceptor</code> 拦截器来自动打印请求和响应等日志：</p>
<p><strong>注意：</strong> <code>LogInterceptor</code> 应该保持最后一个被添加到拦截器中， 否则在它之后进行处理的拦截器修改的内容将无法体现。</p>
<h4 id="Dart"><a href="#Dart" class="headerlink" title="Dart"></a>Dart</h4><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">dio.interceptors.add(LogInterceptor(responseBody: <span class="keyword">false</span>)); <span class="comment">// 不输出响应内容体</span></span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 默认的 <code>logPrint</code> 只会在 DEBUG 模式（启用了断言） 的情况下输出日志。</p>
<p>你也可以使用 <code>dart:developer</code> 中的 <code>log</code> 来输出日志（在 Flutter 中也可以使用）。</p>
<h4 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h4><p>在 Flutter 中你应该使用 <code>debugPrint</code> 来打印日志。</p>
<p>这样也会让调试日志能够通过 <code>flutter logs</code> 获取到。</p>
<p><strong>注意：</strong> <code>debugPrint</code> 的意义 <strong>不是只在 DEBUG 模式下打印</strong>， 而是对输出内容进行节流，从而保证输出完整。 请不要在生产模式使用，除非你有意输出相关日志。</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line">dio.interceptors.add(</span><br><span class="line">  LogInterceptor(</span><br><span class="line">    logPrint: (o) =&gt; debugPrint(o.toString()),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h4><p>开发者可以通过继承 <code>Interceptor/QueuedInterceptor</code> 类来实现自定义拦截器。 这是一个简单的 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/custom_cache_interceptor.dart">缓存拦截器</a>。</p>
<h4 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h4><p>当请求过程中发生错误时, Dio 会将 <code>Error/Exception</code> 包装成一个 <code>DioException</code>:</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 404</span></span><br><span class="line">  <span class="keyword">await</span> dio.<span class="keyword">get</span>(<span class="string">&#x27;https://api.pub.dev/not-exist&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">on</span> DioException <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// The request was made and the server responded with a status code</span></span><br><span class="line">  <span class="comment">// that falls out of the range of 2xx and is also not 304.</span></span><br><span class="line">  <span class="keyword">if</span> (e.response != <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="built_in">print</span>(e.response.data)</span><br><span class="line">    <span class="built_in">print</span>(e.response.headers)</span><br><span class="line">    <span class="built_in">print</span>(e.response.requestOptions)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Something happened in setting up or sending the request that triggered an Error</span></span><br><span class="line">    <span class="built_in">print</span>(e.requestOptions)</span><br><span class="line">    <span class="built_in">print</span>(e.message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="DioException"><a href="#DioException" class="headerlink" title="DioException"></a>DioException</h4><figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// <span class="language-markdown">错误的请求对应的配置。</span></span></span><br><span class="line">RequestOptions requestOptions;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">错误的请求对应的响应内容。如果请求未完成，响应内容可能为空。</span></span></span><br><span class="line">Response? response;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">错误的类型。</span></span></span><br><span class="line">DioExceptionType type;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">实际错误的内容。</span></span></span><br><span class="line"><span class="built_in">Object?</span> error;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">实际错误的堆栈。</span></span></span><br><span class="line">StackTrace? stackTrace;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// <span class="language-markdown">错误信息。</span></span></span><br><span class="line"><span class="built_in">String?</span> message;</span><br></pre></td></tr></table></figure>

<h4 id="使用-application-x-www-form-urlencoded-编码"><a href="#使用-application-x-www-form-urlencoded-编码" class="headerlink" title="使用 application&#x2F;x-www-form-urlencoded 编码"></a>使用 application&#x2F;x-www-form-urlencoded 编码</h4><p>默认情况下, Dio 会将请求数据（除了 <code>String</code> 类型）序列化为 JSON。 如果想要以 <code>application/x-www-form-urlencoded</code> 格式编码, 你可以设置 <code>contentType</code> :</p>
<figure class="highlight dart"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Instance level</span></span><br><span class="line">dio.options.contentType = Headers.formUrlEncodedContentType;</span><br><span class="line"><span class="comment">// or only works once</span></span><br><span class="line">dio.post(</span><br><span class="line">  <span class="string">&#x27;/info&#x27;</span>,</span><br><span class="line">  data: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="number">5</span>&#125;,</span><br><span class="line">  options: Options(contentType: Headers.formUrlEncodedContentType),</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="发送-FormData"><a href="#发送-FormData" class="headerlink" title="发送 FormData"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#%E5%8F%91%E9%80%81-formdata">发送 FormData</a></h4><p>Dio 支持发送 <code>FormData</code>, 请求数据将会以 <code>multipart/form-data</code> 方式编码, <code>FormData</code> 中可以包含一个或多个文件。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">final formData = FormData.fromMap(&#123;</span><br><span class="line">  &#x27;name&#x27;: &#x27;dio&#x27;,</span><br><span class="line">  &#x27;date&#x27;: DateTime.now().toIso8601String(),</span><br><span class="line">  &#x27;file&#x27;: await MultipartFile.fromFile(&#x27;./text.txt&#x27;,filename: &#x27;upload.txt&#x27;)</span><br><span class="line">&#125;);</span><br><span class="line">final response = await dio.post(&#x27;/info&#x27;, data: formData);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通常情况下只有 POST 方法支持发送 FormData。</p>
</blockquote>
<p>这里有一个完整的 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/formdata.dart">示例</a>。</p>
<h4 id="多文件上传"><a href="#多文件上传" class="headerlink" title="多文件上传"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0">多文件上传</a></h4><p>多文件上传时，通过给 key 加中括号 <code>[]</code> 方式作为文件数组的标记，大多数后台也会通过 <code>key[]</code> 来读取多个文件。 然而 RFC 标准中并没有规定多文件上传必须要使用 <code>[]</code>，关键在于后台与客户端之间保持一致。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">final formData = FormData.fromMap(&#123;</span><br><span class="line">  &#x27;files&#x27;: [</span><br><span class="line">    MultipartFile.fromFileSync(&#x27;path/to/upload1.txt&#x27;, filename: &#x27;upload1.txt&#x27;),</span><br><span class="line">    MultipartFile.fromFileSync(&#x27;path/to/upload2.txt&#x27;, filename: &#x27;upload2.txt&#x27;),</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>最终编码时会 key 会为 <code>files[]</code>， **如果不想添加 []**，可以通过 <code>Formdata</code> 的 <code>files</code> 来构建：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">final formData = FormData();</span><br><span class="line">formData.files.addAll([</span><br><span class="line">  MapEntry(</span><br><span class="line">   &#x27;files&#x27;,</span><br><span class="line">    MultipartFile.fromFileSync(&#x27;./example/upload.txt&#x27;,filename: &#x27;upload.txt&#x27;),</span><br><span class="line">  ),</span><br><span class="line">  MapEntry(</span><br><span class="line">    &#x27;files&#x27;,</span><br><span class="line">    MultipartFile.fromFileSync(&#x27;./example/upload.txt&#x27;,filename: &#x27;upload.txt&#x27;),</span><br><span class="line">  ),</span><br><span class="line">]);</span><br></pre></td></tr></table></figure>

<h4 id="复用-FormData-和-MultipartFile"><a href="#复用-FormData-和-MultipartFile" class="headerlink" title="复用 FormData 和 MultipartFile"></a>复用 <code>FormData</code> 和 <code>MultipartFile</code></h4><p>如果你在重复调用的请求中使用 <code>FormData</code> 或者 <code>MultipartFile</code>，确保你每次使用的都是新实例。 常见的错误做法是将 <code>FormData</code> 赋值给一个共享变量，在每次请求中都使用这个变量。 这样的操作会加大 <strong>无法序列化</strong> 的错误出现的可能性。 你可以像以下的代码一样编写你的请求以避免出现这样的错误：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Future&lt;void&gt; _repeatedlyRequest() async &#123;</span><br><span class="line">  Future&lt;FormData&gt; createFormData() async &#123;</span><br><span class="line">    return FormData.fromMap(&#123;</span><br><span class="line">      &#x27;name&#x27;: &#x27;dio&#x27;,</span><br><span class="line">      &#x27;date&#x27;: DateTime.now().toIso8601String(),</span><br><span class="line">      &#x27;file&#x27;: await MultipartFile.fromFile(&#x27;./text.txt&#x27;,filename: &#x27;upload.txt&#x27;),</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  await dio.post(&#x27;some-url&#x27;, data: await createFormData());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="转换器"><a href="#转换器" class="headerlink" title="转换器"></a>转换器</h4><p>转换器 <code>Transformer</code> 用于对请求数据和响应数据进行编解码处理。 Dio 实现了一个默认转换器 <code>DefaultTransformer</code>。 如果你想对请求和响应数据进行自定义编解码处理，可以提供自定义转换器并通过 <code>dio.transformer</code> 设置。</p>
<blockquote>
<p><code>Transformer.transformRequest</code> 只在 <code>PUT</code>&#x2F;<code>POST</code>&#x2F;<code>PATCH</code> 方法中生效， 只有这些方法可以使用请求内容体 (request body)。 但是 <code>Transformer.transformResponse</code> 可以用于所有请求方法的返回数据。</p>
</blockquote>
<h4 id="在-Flutter-中进行设置"><a href="#在-Flutter-中进行设置" class="headerlink" title="在 Flutter 中进行设置"></a>在 Flutter 中进行设置</h4><p>如果你在开发 Flutter 应用，强烈建议通过 <code>compute</code> 在单独的 isolate 中进行 JSON 解码， 从而避免在解析复杂 JSON 时导致的 UI 卡顿。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/// </span><br><span class="line">Map&lt;String, dynamic&gt; _parseAndDecode(String response) &#123;</span><br><span class="line">  return jsonDecode(response) as Map&lt;String, dynamic&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Future&lt;Map&lt;String, dynamic&gt;&gt; parseJson(String text) &#123;</span><br><span class="line">  return compute(_parseAndDecode, text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void main() &#123;</span><br><span class="line">  // 自定义 `jsonDecodeCallback`</span><br><span class="line">  dio.transformer = DefaultTransformer()..jsonDecodeCallback = parseJson;</span><br><span class="line">  runApp(MyApp());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="其它示例"><a href="#其它示例" class="headerlink" title="其它示例"></a>其它示例</h4><p>这里有一个 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/transformer.dart">自定义 Transformer 的示例</a>。</p>
<h4 id="HttpClientAdapter"><a href="#HttpClientAdapter" class="headerlink" title="HttpClientAdapter"></a>HttpClientAdapter</h4><p><code>HttpClientAdapter</code> 是 <code>Dio</code> 和 <code>HttpClient</code> 之间的桥梁。</p>
<p><code>Dio</code> 实现了一套标准且强大的 API，而 <code>HttpClient</code> 则是真正发起 HTTP 请求的对象。</p>
<p>我们通过 <code>HttpClientAdapter</code> 将 <code>Dio</code> 和 <code>HttpClient</code> 解耦， 这样一来便可以自由定制 HTTP 请求的底层实现。 Dio 使用 <code>IOHttpClientAdapter</code> 作为原生平台默认的桥梁， <code>BrowserClientAdapter</code> 作为 Web 平台的桥梁。 你可以通过 <code>HttpClientAdapter()</code> 来根据平台创建它们。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">dio.httpClientAdapter = HttpClientAdapter();</span><br></pre></td></tr></table></figure>

<p>如果你需要单独使用对应平台的适配器：</p>
<ul>
<li><p>对于 Web 平台</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#x27;package:dio/browser.dart&#x27;;</span><br><span class="line">// ...</span><br><span class="line">dio.httpClientAdapter = BrowserClientAdapter();</span><br></pre></td></tr></table></figure></li>
<li><p>对于原生平台：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#x27;package:dio/io.dart&#x27;;</span><br><span class="line">// ...</span><br><span class="line">dio.httpClientAdapter = IOClientAdapter();</span><br></pre></td></tr></table></figure></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/adapter.dart">示例</a> 中包含了一个简单的自定义桥接。</p>
<h4 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86">设置代理</a></h4><p><code>IOHttpClientAdapter</code> 提供了一个 <code>createHttpClient</code> 回调来设置底层 <code>HttpClient</code> 的代理：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#x27;package:dio/io.dart&#x27;;</span><br><span class="line"></span><br><span class="line">void initAdapter() &#123;</span><br><span class="line">  dio.httpClientAdapter = IOHttpClientAdapter(</span><br><span class="line">    createHttpClient: () &#123;</span><br><span class="line">      final client = HttpClient();</span><br><span class="line">      client.findProxy = (uri) &#123;</span><br><span class="line">        // 将请求代理至 localhost:8888。</span><br><span class="line">        // 请注意，代理会在你正在运行应用的设备上生效，而不是在宿主平台生效。</span><br><span class="line">        return &#x27;PROXY localhost:8888&#x27;;</span><br><span class="line">      &#125;;</span><br><span class="line">      return client;</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完整的示例请查看 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/proxy.dart">这里</a>。</p>
<p>Web 平台不支持设置代理。</p>
<h4 id="HTTPS-证书校验"><a href="#HTTPS-证书校验" class="headerlink" title="HTTPS 证书校验"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#https-%E8%AF%81%E4%B9%A6%E6%A0%A1%E9%AA%8C">HTTPS 证书校验</a></h4><p>HTTPS 证书验证（或公钥固定）是指确保端侧与服务器的 TLS 连接的证书是期望的证书，从而减少中间人攻击的机会。 <a target="_blank" rel="noopener" href="https://owasp.org/www-community/controls/Certificate_and_Public_Key_Pinning">OWASP</a> 中解释了该理论。</p>
<p><strong>服务器响应证书</strong></p>
<p>与其他方法不同，此方法使用服务器本身的证书。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void initAdapter() &#123;</span><br><span class="line">  const String fingerprint = &#x27;ee5ce1dfa7a53657c545c62b65802e4272878dabd65c0aadcf85783ebb0b4d5c&#x27;;</span><br><span class="line">  dio.httpClientAdapter = IOHttpClientAdapter(</span><br><span class="line">    createHttpClient: () &#123;</span><br><span class="line">      // Don&#x27;t trust any certificate just because their root cert is trusted.</span><br><span class="line">      final HttpClient client = HttpClient(context: SecurityContext(withTrustedRoots: false));</span><br><span class="line">      // You can test the intermediate / root cert here. We just ignore it.</span><br><span class="line">      client.badCertificateCallback = (cert, host, port) =&gt; true;</span><br><span class="line">      return client;</span><br><span class="line">    &#125;,</span><br><span class="line">    validateCertificate: (cert, host, port) &#123;</span><br><span class="line">      // Check that the cert fingerprint matches the one we expect.</span><br><span class="line">      // We definitely require _some_ certificate.</span><br><span class="line">      if (cert == null) &#123;</span><br><span class="line">        return false;</span><br><span class="line">      &#125;</span><br><span class="line">      // Validate it any way you want. Here we only check that</span><br><span class="line">      // the fingerprint matches the OpenSSL SHA256.</span><br><span class="line">      return fingerprint == sha256.convert(cert.der).toString();</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以使用 OpenSSL 读取密钥的 SHA-256：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">openssl s_client -servername pinning-test.badssl.com -connect pinning-test.badssl.com:443 &lt; /dev/null 2&gt;/dev/null \</span><br><span class="line">  | openssl x509 -noout -fingerprint -sha256</span><br><span class="line"></span><br><span class="line">#### SHA256 Fingerprint=EE:5C:E1:DF:A7:A5:36:57:C5:45:C6:2B:65:80:2E:42:72:87:8D:AB:D6:5C:0A:AD:CF:85:78:3E:BB:0B:4D:5C</span><br><span class="line"># (remove the formatting, keep only lower case hex characters to match the `sha256` above)</span><br></pre></td></tr></table></figure>

<p><strong>证书颁发机构验证</strong></p>
<p>当您的服务器具有自签名证书时，可以用下面的方法，但它们不适用于 AWS 或 Let’s Encrypt 等第三方颁发的证书。</p>
<p>有两种方法可以校验证书，假设我们的后台服务使用的是自签名证书，证书格式是 PEM 格式，我们将证书的内容保存在本地字符串中， 那么我们的校验逻辑如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void initAdapter() &#123;</span><br><span class="line">  String PEM = &#x27;XXXXX&#x27;; // root certificate content</span><br><span class="line">  dio.httpClientAdapter = IOHttpClientAdapter(</span><br><span class="line">    createHttpClient: () &#123;</span><br><span class="line">      final client = HttpClient();</span><br><span class="line">      client.badCertificateCallback = (X509Certificate cert, String host, int port) &#123;</span><br><span class="line">        return cert.pem == PEM; // Verify the certificate.</span><br><span class="line">      &#125;;</span><br><span class="line">      return client;</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于自签名的证书，我们也可以将其添加到本地证书信任链中， 这样证书验证时就会自动通过，而不会再走到 <code>badCertificateCallback</code> 回调中：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">void initAdapter() &#123;</span><br><span class="line">  String PEM = &#x27;XXXXX&#x27;; // root certificate content</span><br><span class="line">  dio.httpClientAdapter = IOHttpClientAdapter(</span><br><span class="line">    onHttpClientCreate: (_) &#123;</span><br><span class="line">      final SecurityContext sc = SecurityContext();</span><br><span class="line">      sc.setTrustedCertificates(File(pathToTheCertificate));</span><br><span class="line">      final HttpClient client = HttpClient(context: sc);</span><br><span class="line">      return client;</span><br><span class="line">    &#125;,</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，通过 <code>setTrustedCertificates()</code> 设置的证书格式必须为 PEM 或 PKCS12， 如果证书格式为 PKCS12，则需将证书密码传入， 这样则会在代码中暴露证书密码，所以客户端证书校验不建议使用 PKCS12 格式的证书。</p>
<h4 id="HTTP-2-支持"><a href="#HTTP-2-支持" class="headerlink" title="HTTP&#x2F;2 支持"></a><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/dio/README-ZH.md#http2-%E6%94%AF%E6%8C%81">HTTP&#x2F;2 支持</a></h4><p><a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/plugins/http2_adapter">dio_http2_adapter</a> 提供了一个支持 HTTP&#x2F;2 的桥接 。</p>
<h4 id="请求取消"><a href="#请求取消" class="headerlink" title="请求取消"></a>请求取消</h4><p>你可以通过 <code>CancelToken</code> 来取消发起的请求。 一个 <code>CancelToken</code> 可以给多个请求共用， 在共用时调用 <code>cancel()</code> 会取消对应的所有请求：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">final cancelToken = CancelToken();</span><br><span class="line">dio.get(url, cancelToken: cancelToken).catchError((DioException err) &#123;</span><br><span class="line">  if (CancelToken.isCancel(err)) &#123;</span><br><span class="line">    print(&#x27;Request canceled: $&#123;err.message&#125;&#x27;);</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    // handle error.</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line">// Cancel the requests with &quot;cancelled&quot; message.</span><br><span class="line">token.cancel(&#x27;cancelled&#x27;);</span><br></pre></td></tr></table></figure>

<p>完整的示例请参考 <a target="_blank" rel="noopener" href="https://github.com/cfug/dio/blob/main/example/lib/cancel_request.dart">取消示例</a>.</p>
<h4 id="继承-Dio-class"><a href="#继承-Dio-class" class="headerlink" title="继承 Dio class"></a>继承 Dio class</h4><p><code>Dio</code> 是一个拥有工厂构造函数的接口类，因此不能直接继承 <code>Dio</code>， 但是可以继承 <code>DioForNative</code> 或 <code>DioForBrowser</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">import &#x27;package:dio/dio.dart&#x27;;</span><br><span class="line">import &#x27;package:dio/io.dart&#x27;;</span><br><span class="line">// 在浏览器中，导入 &#x27;package:dio/browser.dart&#x27;。</span><br><span class="line"></span><br><span class="line">class Http extends DioForNative &#123;</span><br><span class="line">  Http([BaseOptions options]) : super(options) &#123;</span><br><span class="line">    // 构造函数执行</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们也可以直接实现 <code>Dio</code> 接口类 :</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">class MyDio with DioMixin implements Dio &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Web-平台跨域资源共享-CORS"><a href="#Web-平台跨域资源共享-CORS" class="headerlink" title="Web 平台跨域资源共享 (CORS)"></a>Web 平台跨域资源共享 (CORS)</h4><p>在 Web 平台上发送网络请求时，如果请求不是一个 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CORS#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82">简单请求</a>， 浏览器会自动向服务器发送 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Preflight_request">CORS 预检</a> (Pre-flight requests)， 用于检查服务器是否支持跨域资源共享。</p>
<p>你可以参考简单请求的定义修改你的请求，或者为你的服务加上 CORS 中间件进行跨域处理。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/avatar1.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/avatar1.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">菠萝</div><div class="post-copyright__author_desc">可可爱爱，没有脑袋</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://kiritoabc.github.io/2023/10/14/Flutter/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://kiritoabc.github.io/2023/10/14/Flutter/')">flutter</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://kiritoabc.github.io/2023/10/14/Flutter/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=flutter&amp;url=https://kiritoabc.github.io/2023/10/14/Flutter/&amp;pic=https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover3.jpg?_r_=755eab4a-4e60-74b4-9c99-9928f1c2f75c" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://Kiritoabc.github.io" target="_blank">菠萝萝のBLOG</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>安卓开发<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover4.jpg?_r_=ffcde952-172b-7f3b-2ffd-889984a58f95" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/11/React/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover6.jpg?_r_=5a5426ad-2336-4bc6-3c71-2931264ec0d2" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">React</div></div></a></div><div class="next-post pull-right"><a href="/2023/11/02/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover6.jpg?_r_=20dd39d1-69d9-60a0-28db-0f1158b213c3" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">软件测试--测试用例设计方法</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/avatar1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description">菠萝，博客</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">菠萝</h1><div class="author-info__desc">可可爱爱，没有脑袋</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Kiritoabc" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/372204786" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#flutter"><span class="toc-number">1.</span> <span class="toc-text">flutter</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%A1%86%E6%9E%B6dio-v5-3-3"><span class="toc-number">1.1.</span> <span class="toc-text">网络框架dio v5.3.3</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">1.1.1.</span> <span class="toc-text">入门使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Dio-APIs"><span class="toc-number">1.1.2.</span> <span class="toc-text">Dio APIs</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AADio%E5%AE%9E%E4%BE%8B%E5%B9%B6%E9%85%8D%E7%BD%AE%E5%AE%83"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">创建一个Dio实例并配置它</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">请求配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">响应数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.1.2.4.</span> <span class="toc-text">拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%8C%E6%88%90%E5%92%8C%E7%BB%88%E6%AD%A2%E8%AF%B7%E6%B1%82-%E5%93%8D%E5%BA%94"><span class="toc-number">1.1.2.5.</span> <span class="toc-text">完成和终止请求&#x2F;响应</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.1.2.6.</span> <span class="toc-text">日志拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dart"><span class="toc-number">1.1.2.7.</span> <span class="toc-text">Dart</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Flutter"><span class="toc-number">1.1.2.8.</span> <span class="toc-text">Flutter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">1.1.2.9.</span> <span class="toc-text">自定义拦截器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.1.2.10.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DioException"><span class="toc-number">1.1.2.11.</span> <span class="toc-text">DioException</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8-application-x-www-form-urlencoded-%E7%BC%96%E7%A0%81"><span class="toc-number">1.1.2.12.</span> <span class="toc-text">使用 application&#x2F;x-www-form-urlencoded 编码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%91%E9%80%81-FormData"><span class="toc-number">1.1.2.13.</span> <span class="toc-text">发送 FormData</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.1.2.14.</span> <span class="toc-text">多文件上传</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%8D%E7%94%A8-FormData-%E5%92%8C-MultipartFile"><span class="toc-number">1.1.2.15.</span> <span class="toc-text">复用 FormData 和 MultipartFile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-number">1.1.2.16.</span> <span class="toc-text">转换器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8-Flutter-%E4%B8%AD%E8%BF%9B%E8%A1%8C%E8%AE%BE%E7%BD%AE"><span class="toc-number">1.1.2.17.</span> <span class="toc-text">在 Flutter 中进行设置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.1.2.18.</span> <span class="toc-text">其它示例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HttpClientAdapter"><span class="toc-number">1.1.2.19.</span> <span class="toc-text">HttpClientAdapter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86"><span class="toc-number">1.1.2.20.</span> <span class="toc-text">设置代理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTPS-%E8%AF%81%E4%B9%A6%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.1.2.21.</span> <span class="toc-text">HTTPS 证书校验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HTTP-2-%E6%94%AF%E6%8C%81"><span class="toc-number">1.1.2.22.</span> <span class="toc-text">HTTP&#x2F;2 支持</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%96%E6%B6%88"><span class="toc-number">1.1.2.23.</span> <span class="toc-text">请求取消</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF-Dio-class"><span class="toc-number">1.1.2.24.</span> <span class="toc-text">继承 Dio class</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Web-%E5%B9%B3%E5%8F%B0%E8%B7%A8%E5%9F%9F%E8%B5%84%E6%BA%90%E5%85%B1%E4%BA%AB-CORS"><span class="toc-number">1.1.2.25.</span> <span class="toc-text">Web 平台跨域资源共享 (CORS)</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/05/19/Redis%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%B3%BB%E5%88%970/" title="Redis源码阅读0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover4.jpg?_r_=ffcde952-172b-7f3b-2ffd-889984a58f95" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis源码阅读0"/></a><div class="content"><a class="title" href="/2024/05/19/Redis%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB%E7%B3%BB%E5%88%970/" title="Redis源码阅读0">Redis源码阅读0</a><time datetime="2024-05-19T01:13:25.429Z" title="发表于 2024-05-19 01:13:25">2024-05-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/GoGuide-02-MySQL%E5%9F%BA%E7%A1%80/" title="02-MySQL基础"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover7.jpg?_r_=e0a7f849-e3fc-644d-db90-dbc86ef6ff06" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="02-MySQL基础"/></a><div class="content"><a class="title" href="/2024/05/04/GoGuide-02-MySQL%E5%9F%BA%E7%A1%80/" title="02-MySQL基础">02-MySQL基础</a><time datetime="2024-05-04T20:27:43.000Z" title="发表于 2024-05-04 20:27:43">2024-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/05/04/GoGuide-01-Golang%E5%9F%BA%E7%A1%80/" title="01-Golang基础"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover7.jpg?_r_=a88cc275-9a56-504d-c91a-7352a98e789d" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="01-Golang基础"/></a><div class="content"><a class="title" href="/2024/05/04/GoGuide-01-Golang%E5%9F%BA%E7%A1%80/" title="01-Golang基础">01-Golang基础</a><time datetime="2024-05-04T16:54:41.000Z" title="发表于 2024-05-04 16:54:41">2024-05-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/20/CSAPP/" title="CSAPP-01-计算机徐通漫游"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover.jpg?_r_=0d34630a-2164-7890-dce8-5f25fc05da38" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CSAPP-01-计算机徐通漫游"/></a><div class="content"><a class="title" href="/2024/04/20/CSAPP/" title="CSAPP-01-计算机徐通漫游">CSAPP-01-计算机徐通漫游</a><time datetime="2024-04-20T13:04:41.000Z" title="发表于 2024-04-20 13:04:41">2024-04-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/14/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/" title="算法"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/Kiritoabc/my_cdn/img/cover.jpg?_r_=08f981b1-432d-9e70-22ae-60cbd77a7ac6" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="算法"/></a><div class="content"><a class="title" href="/2024/04/14/%E7%AE%97%E6%B3%95%E5%AD%A6%E4%B9%A0/" title="算法">算法</a><time datetime="2024-04-14T10:26:41.000Z" title="发表于 2024-04-14 10:26:41">2024-04-14</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2024 By <a class="footer-bar-link" href="/" title="菠萝" target="_blank">菠萝</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">50</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">31</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">12</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://Kiritoabc.github.io" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/fcircle/"><i class="anzhiyufont anzhiyu-icon-artstation faa-tada" style="font-size: 0.9em;"></i><span> 朋友圈</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/CSAPP/" style="font-size: 0.88rem;">CSAPP<sup>1</sup></a><a href="/tags/Goguide/" style="font-size: 0.88rem;">Goguide<sup>2</sup></a><a href="/tags/SQL/" style="font-size: 0.88rem;">SQL<sup>1</sup></a><a href="/tags/UML/" style="font-size: 0.88rem;">UML<sup>1</sup></a><a href="/tags/golang/" style="font-size: 0.88rem;">golang<sup>8</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>3</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>1</sup></a><a href="/tags/why-what-how/" style="font-size: 0.88rem;">why? what? how?<sup>1</sup></a><a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 0.88rem;">中间件<sup>4</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>3</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F/" style="font-size: 0.88rem;">分布式<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 0.88rem;">前端开发小技巧<sup>2</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">前端知识<sup>1</sup></a><a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 0.88rem;">博客<sup>1</sup></a><a href="/tags/%E5%90%8E%E7%AB%AF%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">后端知识<sup>2</sup></a><a href="/tags/%E5%9F%BA%E7%A1%80zhi-sh/" style="font-size: 0.88rem;">基础zhi'sh<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E7%9F%A5%E8%AF%86/" style="font-size: 0.88rem;">大数据知识<sup>1</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/" style="font-size: 0.88rem;">学习记录<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%8D%93%E5%BC%80%E5%8F%91/" style="font-size: 0.88rem;">安卓开发<sup>1</sup></a><a href="/tags/%E6%9C%BA%E8%80%83/" style="font-size: 0.88rem;">机考<sup>1</sup></a><a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">架构<sup>1</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95/" style="font-size: 0.88rem;">测试<sup>2</sup></a><a href="/tags/%E6%B5%8B%E8%AF%95%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 0.88rem;">测试小技巧<sup>1</sup></a><a href="/tags/%E7%94%9F%E6%B4%BB%E5%B0%8F%E6%8A%80%E5%B7%A7/" style="font-size: 0.88rem;">生活小技巧<sup>1</sup></a><a href="/tags/%E7%AE%80%E5%8E%86%E5%88%B6%E4%BD%9C/" style="font-size: 0.88rem;">简历制作<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>1</sup></a><a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size: 0.88rem;">设计模式<sup>1</sup></a><a href="/tags/%E8%AF%BB%E4%B9%A6%E8%AE%B0%E5%BD%95/" style="font-size: 0.88rem;">读书记录<sup>1</sup></a><a href="/tags/%E9%9D%A2%E7%BB%8F/" style="font-size: 0.88rem;">面经<sup>1</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>1</sup></a><a href="/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/" style="font-size: 0.88rem;">项目管理<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("10/01/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 菠萝 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("10/01/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "";
        img.alt = "";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>